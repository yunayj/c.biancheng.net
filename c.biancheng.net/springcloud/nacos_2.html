<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
<!-- 启用Chromium高速渲染模式 -->
<meta name="renderer" content="webkit" />
<meta name="force-rendering" content="webkit"/>
<!-- 禁止百度转码 -->
<meta name="applicable-device" content="pc,mobile" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!-- 禁止识别电话号码 -->
<meta name="format-detection" content="telephone=no" />

<link rel="shortcut icon" href="../favicon_3.ico" />
<link href="../templets/new/style/common_2.css" rel="stylesheet" />
<title>Nacos：Spring Cloud Alibaba服务注册与配置中心（非常详细）</title>
<meta name="description" content="Nacos 英文全称为 Dynamic Naming and Configuration Service，是一个由阿里巴巴团队使用 Java 语言开发的开源项目。 Nacos 是一个更易于帮助构建云原生应用的动态服务发现、配置和服务管理平台（" />
</head>
<body>
<div id="topbar" class="clearfix">
	<ul id="product-type" class="left">
		<li>
			<a href="../m_biancheng_default_2.html"><span class="iconfont iconfont-home"></span>首页</a>
		</li>
		<li class="active">
			<a href="../sitemap/sitemap_2.html" rel="nofollow"><span class="iconfont iconfont-book"></span>教程</a>
		</li>
		<li>
			<a href="http://vip.biancheng.net/p/vip/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-vip"></span>VIP会员</a>
		</li>
		<li>
			<a href="../fudao_biancheng_default.html" rel="nofollow" target="_blank"><span class="iconfont iconfont-fudao"></span>辅导班</a>
		</li>
		<li>
			<a href="../view/niz69i_5.html" target="_blank"><span class="iconfont iconfont-chip"></span>嵌入式学习路线</a>
		</li>
		<!-- <li>
			<a href="https://www.54benniao.com/c_course/?from=biancheng" target="_blank"><span class="iconfont iconfont-c-course"></span>C语言高级课程</a>
		</li>
		<li>
			<a href="https://www.54benniao.com/java_course/?from=biancheng" target="_blank"><span class="iconfont iconfont-java-course"></span>Java高级课程</a>
		</li>
		<li>
			<a href="http://vip.biancheng.net/p/q2a/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-q2a"></span>一对一答疑</a>
		</li> -->
	</ul>
</div>
<div id="header" class="clearfix">
	<a id="logo" class="left" href="../m_biancheng_default_2.html">
		<img height="26" src="../templets/new/images/logo_2.png" alt="C语言中文网" />
	</a>
	<ul id="nav-main" class="hover-none left clearfix">
		<li class="wap-yes"><a href="../m_biancheng_default_2.html">首页</a></li>
		<li><a href="../c/c_4.html">C语言教程</a></li>
		<li><a href="../cplus/cplus_2.html">C++教程</a></li>
		<li><a href="../python/python_2.html">Python教程</a></li>
		<li><a href="../java/java_2.html">Java教程</a></li>
		<li><a href="../linux_tutorial/linux_tutorial_2.html">Linux入门</a></li>
		<li><a href="../sitemap/sitemap_2.html" title="网站地图">更多&gt;&gt;</a></li>
	</ul>
	<span id="sidebar-toggle" class="toggle-btn" toggle-target="#sidebar">目录 <span class="iconfont"></span></span>

	<a href="http://vip.biancheng.net/?from=topbar" class="user-info iconfont iconfont-user hover-none" target="_blank" rel="nofollow" title="用户中心"></a>
</div>
<div id="main" class="clearfix">
	<div id="sidebar" class="toggle-target">
	<div id="contents">
		<dt><span class="iconfont iconfont-list-vertical" aria-hidden="true"></span><a href="springcloud_2.html">Spring Cloud</a></dt>
		<dd>
        	<span class="channel-num">1</span>
        	<a href="micro-service_2.html">微服务是什么</a>
        </dd>
<dd>
        	<span class="channel-num">2</span>
        	<a href="what-is-cloud_2.html">Spring Cloud是什么</a>
        </dd>
<dd>
        	<span class="channel-num">3</span>
        	<a href="eureka_2.html">Spring Cloud Eureka</a>
        </dd>
<dd>
        	<span class="channel-num">4</span>
        	<a href="ribbon_2.html">Spring Cloud Ribbon</a>
        </dd>
<dd>
        	<span class="channel-num">5</span>
        	<a href="open-feign_2.html">Spring Cloud OpenFeign</a>
        </dd>
<dd>
        	<span class="channel-num">6</span>
        	<a href="hystrix_2.html">Spring Cloud Hystrix</a>
        </dd>
<dd>
        	<span class="channel-num">7</span>
        	<a href="gateway_2.html">Spring Cloud Gateway</a>
        </dd>
<dd>
        	<span class="channel-num">8</span>
        	<a href="config_2.html">Spring Cloud Config</a>
        </dd>
<dd>
        	<span class="channel-num">9</span>
        	<a href="what-is-alibaba_2.html">Spring Cloud Alibaba是什么</a>
        </dd>
<dd>
        	<span class="channel-num">10</span>
        	<a href="nacos_2.html">Spring Cloud Alibaba Nacos</a>
        </dd>
<dd>
        	<span class="channel-num">11</span>
        	<a href="sentinel_2.html">Spring Cloud Alibaba Sentinel</a>
        </dd>
<dd>
        	<span class="channel-num">12</span>
        	<a href="seata_2.html">Spring Cloud Alibaba Seata</a>
        </dd>

	</div>
</div>
	<div id="article-wrap">
		<div id="article">
			<div class="arc-info">
	<span class="position"><span class="iconfont iconfont-home2"></span> <a href="../m_biancheng_default_2.html">首页</a> &gt; <a href="springcloud_2.html">Spring Cloud</a></span>
</div>

<div id="ggxc-position-bottom" class="ggxc-box"></div>
			<h1>Nacos：Spring Cloud Alibaba服务注册与配置中心（非常详细）</h1>
			<div class="pre-next-page clearfix">&nbsp;</div>
			<div id="ggxc-arctop-pc-1" class="ggxc-box"></div>
			<div id="arc-body">Nacos 英文全称为 Dynamic Naming and Configuration Service，是一个由阿里巴巴团队使用 Java 语言开发的开源项目。<br />
<br />
Nacos 是一个更易于帮助构建云原生应用的动态服务发现、配置和服务管理平台（参考自 <a href="https://nacos.io/zh-cn/index.html" target="_blank">Nacos 官网</a>）。<br />
<br />
Nacos 的命名是由 3 部分组成：<br />
<br />
<table>
	<tbody>
		<tr>
			<th>
				组成部分</th>
			<th>
				全称</th>
			<th>
				描述</th>
		</tr>
		<tr>
			<td>
				Na</td>
			<td>
				naming/nameServer</td>
			<td>
				即服务注册中心，与 Spring Cloud Eureka 的功能类似。</td>
		</tr>
		<tr>
			<td>
				co</td>
			<td>
				configuration</td>
			<td>
				即配置中心，与 Spring Cloud Config+Spring Cloud Bus 的功能类似。</td>
		</tr>
		<tr>
			<td>
				s</td>
			<td>
				service</td>
			<td>
				即服务，表示 Nacos 实现的服务注册中心和配置中心都是以服务为核心的。</td>
		</tr>
	</tbody>
</table>
<br />
我们可以将 Nacos 理解成服务注册中心和配置中心的组合体，它可以替换 <a href="eureka_2.html" target="_blank">Eureka</a> 作为服务注册中心，实现服务的注册与发现；还可以替换 <a href="config_2.html" target="_blank">Spring Cloud Config</a>&nbsp;作为配置中心，实现配置的动态刷新。<br />
<br />
Nacos 作为服务注册中心经历了十年&ldquo;双十一&rdquo;的洪峰考验，具有简单易用、稳定可靠、性能卓越等优点，可以帮助用户更敏捷、容易地构建和管理微服务应用。<br />
<br />
Nacos 支持几乎所有主流类型&ldquo;服务&rdquo;的发现、配置和管理：
<ul>
	<li>
		<a href="https://kubernetes.io/docs/concepts/services-networking/service/" target="_blank">Kubernetes Service</a></li>
	<li>
		<a href="https://grpc.io/docs/what-is-grpc/core-concepts#service-definition" target="_blank">gRPC </a>&amp; <a href="https://dubbo.apache.org/zh/" target="_blank">Dubbo RPC Service</a></li>
	<li>
		Spring Cloud RESTful Service</li>
</ul>
<h2>
	Nacos 的特性</h2>
Nacos 提供了一系列简单易用的特性，能够帮助我们快速地实现动态服务发现、服务配置等功能。
<h4>
	服务发现</h4>
Nacos 支持基于 DNS 和 RPC 的服务发现。当服务提供者使用原生 SDK、OpenAPI 或一个独立的 Agent TODO 向 Nacos 注册服务后，服务消费者可以在 Nacos 上通过 DNS TODO 或 HTTP&amp;API 查找、发现服务。<br />
<h4>
	服务健康监测</h4>
Nacos 提供对服务的实时健康检查，能够阻止请求发送到不健康主机或服务实例上。Nacos 还提供了一个健康检查仪表盘，能够帮助我们根据健康状态管理服务的可用性及流量。
<h4>
	动态配置服务</h4>
动态配置服务可以让我们以中心化、外部化和动态化的方式，管理所有环境的应用配置和服务配置。<br />
<br />
动态配置消除了配置变更时重新部署应用和服务的需要，让配置管理变得更加高效、敏捷。<br />
<br />
配置中心化管理让实现无状态服务变得更简单，让服务按需弹性扩展变得更容易。<br />
<br />
Nacos 提供了一个简洁易用的 UI 帮助我们管理所有服务和应用的配置。Nacos 还提供包括配置版本跟踪、金丝雀发布、一键回滚配置以及客户端配置更新状态跟踪在内的一系列开箱即用的配置管理特性，帮助我们更安全地在生产环境中管理配置变更和降低配置变更带来的风险。
<h4>
	动态 DNS 服务</h4>
Nacos 提供了动态 DNS 服务，能够让我们更容易地实现负载均衡、流量控制以及数据中心内网的简单 DNS 解析服务。<br />
<br />
Nacos 提供了一些简单的 DNS APIs TODO，可以帮助我们管理服务的关联域名和可用的 IP:PORT 列表。
<h4>
	服务及其元数据管理</h4>
Nacos 能让我们从微服务平台建设的视角管理数据中心的所有服务及元数据，包括管理服务的描述、生命周期、服务的静态依赖分析、服务的健康状态、服务的流量管理、路由及安全策略、服务的 SLA 以及 metrics 统计数据。
<h2>
	Nacos 两大组件</h2>
与 Eureka 类似，Nacos 也采用 CS（Client/Server，客户端/服务器）架构，它包含两大组件，如下表。<br />
、
<table>
	<tbody>
		<tr>
			<th>
				组件</th>
			<th>
				描述</th>
			<th>
				功能</th>
		</tr>
		<tr>
			<td colspan="1" rowspan="2">
				Nacos Server</td>
			<td colspan="1" rowspan="2">
				Nacos 服务端，与 Eureka Server 不同，Nacos Server 由阿里巴巴团队使用 Java 语言编写并将 Nacos Server 的下载地址给用户，用户只需要直接下载并运行即可。</td>
			<td>
				Nacos Server 可以作为服务注册中心，帮助&nbsp;Nacos Client 实现服务的注册与发现。</td>
		</tr>
		<tr>
			<td>
				Nacos Server 可以作为配置中心，帮助 Nacos Client 在不重启的情况下，实现配置的动态刷新。</td>
		</tr>
		<tr>
			<td colspan="1" rowspan="2">
				Nacos Client</td>
			<td colspan="1" rowspan="2">
				Nacos&nbsp;客户端，通常指的是微服务架构中的各个服务，由用户自己搭建，可以使用多种语言编写。</td>
			<td>
				Nacos Client 通过添加依赖 spring-cloud-starter-alibaba-nacos-discovery，在服务注册中心（Nacos Server）中实现服务的注册与发现。</td>
		</tr>
		<tr>
			<td>
				Nacos Client 通过添加依赖&nbsp;spring-cloud-starter-alibaba-nacos-config，在配置中心（Nacos Server）中实现配置的动态刷新。</td>
		</tr>
	</tbody>
</table>
<h2>
	Nacos 服务注册中心</h2>
Nacos 作为服务注册中心可以实现服务的注册与发现，流程如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="Nacos 服务注册与发现" src="../uploads/allimg/211210/1022563360-0_2.png" /><br />
	图1：Nacos 服务注册与发现</div>
<br />
在图 1 中共涉及到以下 3 个角色：
<ul>
	<li>
		服务注册中心（Register Service）：它是一个 Nacos Server，可以为服务提供者和服务消费者提供服务注册和发现功能。</li>
	<li>
		服务提供者（Provider Service）：它是一个 Nacos Client，用于对外服务。它将自己提供的服务注册到服务注册中心，以供服务消费者发现和调用。</li>
	<li>
		服务消费者（Consumer Service）：它是一个 Nacos Client，用于消费服务。它可以从服务注册中心获取服务列表，调用所需的服务。</li>
</ul>
<br />
Nacos 实现服务注册与发现的流程如下：
<ol>
	<li>
		从 Nacos 官方提供的下载页面中，下载 Nacos Server 并运行。</li>
	<li>
		服务提供者 Nacos Client 启动时，会把服务以服务名（spring.application.name）的方式注册到服务注册中心（Nacos Server）；</li>
	<li>
		服务消费者 Nacos Client 启动时，也会将自己的服务注册到服务注册中心；</li>
	<li>
		服务消费者在注册服务的同时，它还会从服务注册中心获取一份服务注册列表信息，该列表中包含了所有注册到服务注册中心上的服务的信息（包括服务提供者和自身的信息）；</li>
	<li>
		在获取了服务提供者的信息后，服务消费者通过 HTTP 或消息中间件远程调用服务提供者提供的服务。</li>
</ol>
<h4>
	安装和运行 Nacos Server</h4>
下面我们以 Nacos 2.0.3 为例，演示下如何安装和运行 Nacos Server，步骤如下。<br />
<br />
1. 使用浏览器访问&nbsp;<a href="https://github.com/alibaba/nacos/releases/tag/2.0.3" target="_blank">Nacos Server 下载页面</a>，并在页面最下方点击链接 nacos-server-2.0.3.zip，如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="Nacos 下载" src="../uploads/allimg/211210/1022562c6-1_2.png" style="border-width: 1px; border-style: solid;" /><br />
	图2：Nacos Server 下载</div>
<br />
2. 下载完成后，解压&nbsp;nacos-server-2.0.3.zip，目录结构如下。<br />
<br />
<div style="text-align: center;">
	<img alt="" src="../uploads/allimg/211210/1022563922-2_2.png" style="border-width: 1px; border-style: solid;" /><br />
	图3：Nacos Server 目录结构</div>
<br />
Nacos Server 下各目录说明如下：
<ul>
	<li>
		bin：用于存放 Nacos 的可执行命令。</li>
	<li>
		conf：用于存放&nbsp;Nacos 配置文件。</li>
	<li>
		target：用于存放 Nacos 应用的 jar 包。</li>
</ul>
<br />
3. 打开命令行窗口，跳转到 Nacos Server 安装目录的 bin 下，执行以下命令，以单机模式启动 Nacos Server。
<pre class="info-box">
startup.cmd -m standalone</pre>
<br />
4. Nacos Server 启动日志如下。
<pre class="info-box">
&quot;nacos is starting with standalone&quot;

         ,--.
       ,--.&#39;|
   ,--,:  : |                                           Nacos 2.0.3
,`--.&#39;`|  &#39; :                       ,---.               Running in stand alone mode, All function modules
|   :  :  | |                      &#39;   ,&#39;\   .--.--.    Port: 8848
:   |   \ | :  ,--.--.     ,---.  /   /   | /  /    &#39;   Pid: 27512
|   : &#39;  &#39;; | /       \   /     \.   ; ,. :|  :  /`./   Console: http://192.168.3.138:8848/nacos/index.html
&#39;   &#39; ;.    ;.--.  .-. | /    / &#39;&#39;   | |: :|  :  ;_
|   | | \   | \__\/: . ..    &#39; / &#39;   | .; : \  \    `.      https://nacos.io
&#39;   : |  ; .&#39; ,&quot; .--.; |&#39;   ; :__|   :    |  `----.   \
|   | &#39;`--&#39;  /  /  ,.  |&#39;   | &#39;.&#39;|\   \  /  /  /`--&#39;  /
&#39;   : |     ;  :   .&#39;   \   :    : `----&#39;  &#39;--&#39;.     /
;   |.&#39;     |  ,     .-./\   \  /            `--&#39;---&#39;
&#39;---&#39;        `--`---&#39;     `----&#39;

2021-11-08 16:16:38,877 INFO Bean &#39;org.springframework.security.access.expression.method.DefaultMethodSecurityExpressionHandler@5ab9b447&#39; of type [org.springframework.security.access.expression.method
.DefaultMethodSecurityExpressionHandler] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2021-11-08 16:16:38,884 INFO Bean &#39;methodSecurityMetadataSource&#39; of type [org.springframework.security.access.method.DelegatingMethodSecurityMetadataSource] is not eligible for getting processed by al
l BeanPostProcessors (for example: not eligible for auto-proxying)
2021-11-08 16:16:40,001 INFO Tomcat initialized with port(s): 8848 (http)
2021-11-08 16:16:40,713 INFO Root WebApplicationContext: initialization completed in 14868 ms
2021-11-08 16:16:52,351 INFO Initializing ExecutorService &#39;applicationTaskExecutor&#39;
2021-11-08 16:16:52,560 INFO Adding welcome page: class path resource [static/index.html]
2021-11-08 16:16:54,239 INFO Creating filter chain: Ant [pattern=&#39;/**&#39;], []
2021-11-08 16:16:54,344 INFO Creating filter chain: any request, [org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@7dd611c8, org.springframework.security.web.con
text.SecurityContextPersistenceFilter@5c7668ba, org.springframework.security.web.header.HeaderWriterFilter@fb713e7, org.springframework.security.web.csrf.CsrfFilter@6ec7bce0, org.springframework.secur
ity.web.authentication.logout.LogoutFilter@7d9ba6c, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@158f4cfe, org.springframework.security.web.servletapi.SecurityContextHolderAwa
reRequestFilter@6c6333cd, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@5d425813, org.springframework.security.web.session.SessionManagementFilter@13741d5a, org.springf
ramework.security.web.access.ExceptionTranslationFilter@3727f0ee]
2021-11-08 16:16:54,948 INFO Initializing ExecutorService &#39;taskScheduler&#39;
2021-11-08 16:16:54,977 INFO Exposing 16 endpoint(s) beneath base path &#39;/actuator&#39;
2021-11-08 16:16:55,309 INFO Tomcat started on port(s): 8848 (http) with context path &#39;/nacos&#39;
2021-11-08 16:16:55,319 INFO Nacos started successfully in stand alone mode. use embedded storage</pre>
<br />
5. 使用浏览器访问&ldquo;http://localhost:8848/nacos&rdquo;，跳转到 Nacos Server 登陆页面，如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="Nacos 登陆页面" src="../uploads/allimg/211210/1022562045-3_2.png" /><br />
	图4：Nacos Server 登陆页面</div>
<br />
6. 在登陆页输入登录名和密码（默认都是 nacos），点击提交按钮，跳转到 Nacos Server 控制台主页，如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="Nacos Server 主页" src="../uploads/allimg/211210/10225633C-4_2.png" /><br />
	图5：Nacos Server 控制台</div>
<br />
自此，我们就完成了 Nacos Server 的下载、安装和运行工作。<br />
<h4>
	搭建服务提供者</h4>
接下来，我们来搭建一个服务提供者，步骤如下。<br />
<br />
1.&nbsp;创建一个名为 spring-cloud-alibaba-demo 的 Maven 工程 ，该工程的 pom.xml 内容如下。
<pre class="xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;packaging&gt;pom&lt;/packaging&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.5.6&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-alibaba-demo&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
        &lt;junit.version&gt;4.12&lt;/junit.version&gt;
        &lt;log4j.version&gt;1.2.17&lt;/log4j.version&gt;
        &lt;lombok.version&gt;1.16.18&lt;/lombok.version&gt;
        &lt;spring-cloud.version&gt;2020.0.4&lt;/spring-cloud.version&gt;
    &lt;/properties&gt;
    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;!--Spring Cloud Alibaba 的版本信息--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
                &lt;version&gt;2021.1&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
            &lt;!--Spring Cloud 的版本信息--&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
&lt;/project&gt;</pre>
<blockquote>
	<p>
		在该工程的 pom.xml 中，我们通过 dependencyManagement 对 Spring Cloud Alibaba 的版本信息进行管理，该工程下的各个子模块在引入 Spring Cloud Alibaba 的各个组件时就不要单独指定版本号了。</p>
</blockquote>
2. 在&nbsp;spring-cloud-alibaba-demo 下，创建一个名为&nbsp;spring-cloud-alibaba-provider-8001 的 Spring Boot 模块，并在其 pom.xml 中添加以下依赖，内容如下。
<pre class="xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;!--父工程--&gt;
    &lt;parent&gt;
        &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;artifactId&gt;spring-cloud-alibaba-demo&lt;/artifactId&gt;
    &lt;/parent&gt;

    &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-alibaba-provider-8001&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;spring-cloud-alibaba-provider-8001&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!--Spring Cloud Alibaba Nacos discovery --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</pre>
<br />
3. 在 spring-cloud-alibaba-provider-8001 的配置文件 application.properties 中添加以下配置，内容如下。
<pre class="info-box">
#端口号
server.port=8001
#服务名
spring.application.name=spring-cloud-alibaba-provider
#Nacos Server 的地址
spring.cloud.nacos.discovery.server-addr=127.0.0.1:8848
management.endpoints.web.exposure.include=*</pre>
<br />
4. 在 net.biacheng.c.controller 包下，创建一个名为&nbsp;DeptController 的 Controller 类，代码如下。
<pre class="java">
package net.biancheng.c.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;

@RestController
@Slf4j
public class DeptController {
    @Value(&quot;${server.port}&quot;)
    private String serverPort;

    @GetMapping(value = &quot;/dept/nacos/{id}&quot;)
    public String getPayment(@PathVariable(&quot;id&quot;) Integer id) {
        return &quot;&lt;h2&gt;c语言中文网提醒您，服务访问成功！&lt;/h2&gt;服务名：spring-cloud-alibaba-provider&lt;br /&gt; 端口号： &quot; + serverPort + &quot;&lt;br /&gt; 传入的参数：&quot; + id;
    }
}</pre>
<br />
5. 在&nbsp;spring-cloud-alibaba-provider-8001 的主启动类上，使用 @EnableDiscoveryClient 注解开启 Nacos 服务发现功能，代码如下。
<pre class="java">
package net.biancheng.c;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient //开启服务发现功能
public class SpringCloudAlibabaProvider8001Application {

    public static void main(String[] args) {
        SpringApplication.run(SpringCloudAlibabaProvider8001Application.class, args);
    }

}</pre>
<br />
6. 启动&nbsp;spring-cloud-alibaba-provider-8001，使用浏览器访问&ldquo;http://localhost:8001/dept/nacos/1&rdquo;，结果如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="访问服务提供者的服务" src="../uploads/allimg/211210/10225C033-5_2.png" /><br />
	图6：服务提供者</div>
<br />
7. 使用浏览器访问&ldquo;http://localhost:8848/nacos&rdquo;，查看&ldquo;服务管理&rdquo;下的&ldquo;服务列表&rdquo;，如下图。<br />
<br />
<div style="text-align: center;">
	<a href="http://new-local.weixueyuan.net/uploads/allimg/211108/6-21110QJ12b02.png" target="_blank"><img alt="Nacos 服务列表" src="../uploads/allimg/211210/10225Ab5-6_2.png" /></a><br />
	图7：服务注册列表</div>
<br />
从图 7 可以看到，我们搭建的服务提供者 spring-cloud-alibaba-provider-8001 所提供的服务已经被注册到了 Nacos Server 上了。
<h4>
	搭建服务消费者</h4>
下面，我们就来搭建一个服务消费者来消费&nbsp;spring-cloud-alibaba-provider-8001 提供的服务，步骤如下。<br />
<br />
1. 在主工程&nbsp;spring-cloud-alibaba-demo 下，创建一个名为&nbsp;spring-cloud-alibaba-consumer-nacos-8801 的 Spring Boot 模块，并在其 pom.xml 中添加以下依赖。
<pre class="xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
&nbsp;&nbsp;&nbsp; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
&nbsp;&nbsp;&nbsp; &lt;parent&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;spring-cloud-alibaba-demo&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp; &lt;/parent&gt;
&nbsp;&nbsp;&nbsp; &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;spring-cloud-alibaba-consumer-nacos-8081&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&nbsp;&nbsp;&nbsp; &lt;name&gt;spring-cloud-alibaba-consumer-nacos-8081&lt;/name&gt;
&nbsp;&nbsp;&nbsp; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
&nbsp;&nbsp;&nbsp; &lt;properties&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;java.version&gt;1.8&lt;/java.version&gt;
&nbsp;&nbsp;&nbsp; &lt;/properties&gt;
&nbsp;&nbsp;&nbsp; &lt;dependencies&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!--SpringCloud ailibaba nacos discovery--&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;!--由于 Netflix Ribbon 进入停更维护阶段，因此新版本的 Nacos discovery 都已经移除了 Ribbon ，此时我们需要引入 loadbalancer 代替 --&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;spring-cloud-loadbalancer&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/dependency&gt;

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;scope&gt;runtime&lt;/scope&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;optional&gt;true&lt;/optional&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;lombok&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;optional&gt;true&lt;/optional&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dependency&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;scope&gt;test&lt;/scope&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/dependency&gt;
&nbsp;&nbsp;&nbsp; &lt;/dependencies&gt;

&nbsp;&nbsp;&nbsp; &lt;build&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;plugins&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;plugin&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;configuration&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;excludes&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;exclude&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;artifactId&gt;lombok&lt;/artifactId&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/exclude&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/excludes&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/configuration&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/plugin&gt;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/plugins&gt;
&nbsp;&nbsp;&nbsp; &lt;/build&gt;
&lt;/project&gt;
</pre>
<blockquote>
	<p>
		注意：由于 Netflix Ribbon 已经进入停更维护状态，Nacos Discovery 已经停了对 Ribbon 的支持，因此我们需要在服务消费者的 pom.xml 中引入&nbsp;spring-cloud-loadbalancer 才能调用服务提供者提供的服务。</p>
</blockquote>
2. 在&nbsp;spring-cloud-alibaba-consumer-nacos-8801 的配置文件 application.yml 中，添加以下配置。
<pre class="xml">
server:
  port: 8801  #端口号
spring:
  application:
    name: spring-cloud-alibaba-consumer #服务名
  cloud:
    nacos:
      discovery:
        server-addr: localhost:8848  #Nacos server 的地址

#以下配置信息并不是默认配置，而是我们自定义的配置，目的是不在 Controller 内硬编码服务提供者的服务名
service-url:
  nacos-user-service: http://spring-cloud-alibaba-provider #服务提供者的服务名</pre>
<br />
3. 在&nbsp;spring-cloud-alibaba-consumer-nacos-8801 的主启动类上，使用 @EnableDiscoveryClient 注解开启服务发现功能，代码如下。
<pre class="java">
package net.biancheng.c;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient // 开启服务注册与发现功能
public class SpringCloudAlibabaConsumerNacos8801Application {

    public static void main(String[] args) {
        SpringApplication.run(SpringCloudAlibabaConsumerNacos8081Application.class, args);
    }

}</pre>
<br />
4. 在&nbsp;net.biancheng.c.config 包下创建一个名为 ApplicationContextBean 的配置类，并使用 @LoadBalanced 注解与 Ribbon 进行集成开启负载均衡功能，代码如下。
<pre class="java">
package net.biancheng.c.config;

import org.springframework.cloud.client.loadbalancer.LoadBalanced;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.client.RestTemplate;

@Configuration
public class ApplicationContextBean {

    @Bean
    @LoadBalanced //与 Ribbon 集成，并开启负载均衡功能
    public RestTemplate getRestTemplate() {
        return new RestTemplate();
    }
}</pre>
<br />
5. 在&nbsp;net.biancheng.c.controller 包下，创建一个名为&nbsp;DeptController_Consumer 的 Controller 类，代码如下。
<pre class="java">
package net.biancheng.c.controller;

import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.client.RestTemplate;

import javax.annotation.Resource;

@RestController
@Slf4j
public class DeptController_Consumer {

    @Resource
    private RestTemplate restTemplate;

    @Value(&quot;${service-url.nacos-user-service}&quot;)
    private String serverURL; //服务提供者的服务名

    @GetMapping(&quot;/consumer/dept/nacos/{id}&quot;)
    public String paymentInfo(@PathVariable(&quot;id&quot;) Long id) {
        return restTemplate.getForObject(serverURL + &quot;/dept/nacos/&quot; + id, String.class);
    }
}</pre>
<br />
6. 启动&nbsp;spring-cloud-alibaba-consumer-nacos-8801，查看 Nacos Server 的服务列表，如下图。<br />
<br />
<div style="text-align: center;">
	<a href="http://new-local.weixueyuan.net/uploads/allimg/211109/6-21110Z91435H1.png" target="_blank"><img alt="服务消费者这 Nacos Server " src="../uploads/allimg/211210/10225621N-7_2.png" /></a><br />
	图8：服务消费者</div>
<br />
7. 使用浏览器访问&ldquo;http://localhost:8801/consumer/dept/nacos/1&rdquo;，结果如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="Nacos 服务消费者消费服务" src="../uploads/allimg/211210/10225B156-8_2.png" /><br />
	图9：服务消费者调用服务</div>
<h2>
	Nacos 配置中心</h2>
Nacos Server 还可以作为配置中心，对 Spring Cloud 应用的外部配置进行统一地集中化管理。而我们只需要在应用的 POM 文件中引入&nbsp;spring-cloud-starter-alibaba-nacos-config 即可实现配置的获取与动态刷新。<br />
<br />
从配置管理的角度看，Nacos 可以说是 Spring Cloud Config 的替代方案，但相比后者 Nacos 的使用更简单，操作步骤也更少。<br />
<br />
接下来，我们通过一个实例来演示下 Nacos 是如何实现配置的统一管理和动态刷新的。<br />
<br />
1. 在主工程&nbsp;spring-cloud-alibaba-demo 下，创建一个名为&nbsp;spring-cloud-alibaba-config-client-3377 的 Spring Boot 模块，并在其 pom.xml 中添加以下依赖。
<pre class="xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
        &lt;artifactId&gt;spring-cloud-alibaba-demo&lt;/artifactId&gt;
    &lt;/parent&gt;
    &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-alibaba-config-client-3377&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;spring-cloud-alibaba-nacos-config-client-3377&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--SpringCloud2020及以后的版本默认不启用 bootstrap 配置，我们需要在pom里面显式地引入：--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!--Spring Cloud Alibaba Config 依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--SpringCloud ailibaba nacos 服务注册与发现模块 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--Spring Boot 监控模块--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;</pre>
<blockquote>
	<p>
		注意：我们使用的 Spring Cloud 2020 版本默认不启用 bootstrap，若想要在应用启动时加载 bootstrap 配置（例如 bootstrap.yml 或 bootstrap.properties），就需要我们在 pom.xml 中显式的引入&nbsp;spring-cloud-starter-bootstrap 依赖。</p>
</blockquote>
2. 在 spring-cloud-alibaba-config-client-3377 的类路径（例如 /resources 目录）下，添加一个 bootstrap.yml，配置内容如下。<br />
<pre class="xml">
server:
  port: 3377 #端口号
spring:
  application:
    name: config-client #服务名
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848 #Nacos服务注册中心地址

      config:
        server-addr: 127.0.0.1:8848 #Nacos作为配置中心地址
        file-extension: yaml #指定yaml格式的配置</pre>
<br />
3. 在 spring-cloud-alibaba-config-client-3377 的类路径（例如 /resources 目录）下，添加一个 application.yml，配置内容如下。
<pre class="xml">
spring:
  profiles:
    active: dev #激活 dev 的配置</pre>
<br />
4. 在&nbsp;net.biancheng.c.controller 包下，创建一个名为&nbsp;ConfigClientController 的 Controller 类，并在该类上使用 @RefreshScope 注解实现配置的自动更新，代码如下。
<pre class="java">
package net.biancheng.c.controller;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.cloud.context.config.annotation.RefreshScope;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RefreshScope
public class ConfigClientController {

    @Value(&quot;${config.info}&quot;)
    private String ConfigInfo;

    @GetMapping(&quot;/config/info&quot;)
    public String getConfigInfo(){
        return ConfigInfo;
    }
}</pre>
<br />
5. 在&nbsp;spring-cloud-alibaba-config-client-3377 的主启动类上，使用 @EnableDiscoveryClient 注解开启服务发现功能，代码如下。
<pre class="java">
package net.biancheng.c;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.client.discovery.EnableDiscoveryClient;

@SpringBootApplication
@EnableDiscoveryClient
public class SpringCloudAlibabaNacosConfigClient3377Application {

    public static void main(String[] args) {
        SpringApplication.run(SpringCloudAlibabaNacosConfigClient3377Application.class, args);
    }
}</pre>
<br />
6. 启动 Nacos Server，并在 Nacos Server 控制台的&ldquo;配置管理&rdquo;下的&ldquo;配置列表&rdquo;中，点击&ldquo;+&rdquo;按钮，新建如下配置。<br />
<pre class="info-box">
Data ID:        config-client-dev.yaml

Group  :        DEFAULT_GROUP

配置格式:        YAML

配置内容:      config:
                  info: c.biancheng.net</pre>
<br />
在 Nacos Server 中，配置的 dataId（即 Data ID）的完整格式如下：
<pre class="info-box">
${prefix}-${spring.profiles.active}.${file-extension}</pre>
<br />
dataId 格式中各参数说明如下：
<ul>
	<li>
		${prefix}：默认取值为微服务的服务名，即配置文件中 spring.application.name 的值，我们可以在配置文件中通过配置&nbsp;spring.cloud.nacos.config.prefix 来指定。</li>
	<li>
		${spring.profiles.active}：表示当前环境对应的 Profile，例如 dev、test、prod 等。当没有指定环境的 Profile 时，其对应的连接符也将不存在， dataId 的格式变成&nbsp;${prefix}.${file-extension}。</li>
	<li>
		${file-extension}：表示配置内容的数据格式，我们可以在配置文件中通过配置项 spring.cloud.nacos.config.file-extension 来配置，例如&nbsp;properties 和 yaml。</li>
</ul>
<br />
7. 启动&nbsp;spring-cloud-alibaba-config-client-3377，并使用浏览器访问&ldquo;http://localhost:3377/config/info&rdquo;，结果如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="Nacos Config" src="../uploads/allimg/211210/10225B3C-9_2.png" /><br />
	图10：Nacos Config</div>
<br />
8. 在 Nacos Server 中，将 config-client-dev.yaml 中的配置修改成如下内容。<br />
<pre class="info-box">
config:
    info: this is c.biancheng.net</pre>
<br />
9. 在不重启&nbsp;spring-cloud-alibaba-config-client-3377 的情况下，使用浏览器再次访问&ldquo;http://localhost:3377/config/info&rdquo;，结果如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="" src="../uploads/allimg/211210/1022563A7-10_2.png" /><br />
	图11：Nacos Cofig</div>
<h2>
	Nacos Server 集群化部署</h2>
在实际的项目开发中，一个微服务系统往往由十几，几十个甚至几百个微服务组成。 这些服务若全部注册到同一台 Nacos Server，就极有可能导致 Nacos Server 因为不堪重负而崩溃，最终导致整个微服务系统瘫痪。解决这个问题最直接的办法就是使用 Nacos Server 集群。<br />
<br />
Nacos Server 的集群化部署有一个十分明显的优点，那就是可以保障系统的高可用性。在集群化部署中，只要不是所有的 Nacos Server 都停止工作，Nacos Client 就还可以从集群中正常的 Nacos Server 上获取服务信息及配置，而不会导致系统的整体瘫痪，这就是 Nacos Server 集群化部署的高可用性。<br />
<br />
下图展示了 Nacos Server 集群化部署的基本架构。<br />
<br />
<div style="text-align: center;">
	<img alt="Nacos Server 集群架构" src="../uploads/allimg/211210/1022563543-11_2.png" /><br />
	图12：Nacos Server 集群架构</div>
<br />
下面我们以 Windows 系统为例，演示如何部署 Nacos Server 集群。<br />
<br />
1. 在 MySQL 中，新建一个名为&nbsp;nacos_config 的数据库实例，并在该数据库下执行以下 SQL 语句。
<pre class="info-box">
/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info   */
/******************************************/
CREATE TABLE `config_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,
  `data_id` varchar(255) NOT NULL COMMENT &#39;data_id&#39;,
  `group_id` varchar(255) DEFAULT NULL,
  `content` longtext NOT NULL COMMENT &#39;content&#39;,
  `md5` varchar(32) DEFAULT NULL COMMENT &#39;md5&#39;,
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,
  `src_user` text COMMENT &#39;source user&#39;,
  `src_ip` varchar(50) DEFAULT NULL COMMENT &#39;source ip&#39;,
  `app_name` varchar(128) DEFAULT NULL,
  `tenant_id` varchar(128) DEFAULT &#39;&#39; COMMENT &#39;租户字段&#39;,
  `c_desc` varchar(256) DEFAULT NULL,
  `c_use` varchar(64) DEFAULT NULL,
  `effect` varchar(64) DEFAULT NULL,
  `type` varchar(64) DEFAULT NULL,
  `c_schema` text,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#39;config_info&#39;;

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info_aggr   */
/******************************************/
CREATE TABLE `config_info_aggr` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,
  `data_id` varchar(255) NOT NULL COMMENT &#39;data_id&#39;,
  `group_id` varchar(255) NOT NULL COMMENT &#39;group_id&#39;,
  `datum_id` varchar(255) NOT NULL COMMENT &#39;datum_id&#39;,
  `content` longtext NOT NULL COMMENT &#39;内容&#39;,
  `gmt_modified` datetime NOT NULL COMMENT &#39;修改时间&#39;,
  `app_name` varchar(128) DEFAULT NULL,
  `tenant_id` varchar(128) DEFAULT &#39;&#39; COMMENT &#39;租户字段&#39;,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#39;增加租户字段&#39;;


/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info_beta   */
/******************************************/
CREATE TABLE `config_info_beta` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,
  `data_id` varchar(255) NOT NULL COMMENT &#39;data_id&#39;,
  `group_id` varchar(128) NOT NULL COMMENT &#39;group_id&#39;,
  `app_name` varchar(128) DEFAULT NULL COMMENT &#39;app_name&#39;,
  `content` longtext NOT NULL COMMENT &#39;content&#39;,
  `beta_ips` varchar(1024) DEFAULT NULL COMMENT &#39;betaIps&#39;,
  `md5` varchar(32) DEFAULT NULL COMMENT &#39;md5&#39;,
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,
  `src_user` text COMMENT &#39;source user&#39;,
  `src_ip` varchar(50) DEFAULT NULL COMMENT &#39;source ip&#39;,
  `tenant_id` varchar(128) DEFAULT &#39;&#39; COMMENT &#39;租户字段&#39;,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#39;config_info_beta&#39;;

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_info_tag   */
/******************************************/
CREATE TABLE `config_info_tag` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,
  `data_id` varchar(255) NOT NULL COMMENT &#39;data_id&#39;,
  `group_id` varchar(128) NOT NULL COMMENT &#39;group_id&#39;,
  `tenant_id` varchar(128) DEFAULT &#39;&#39; COMMENT &#39;tenant_id&#39;,
  `tag_id` varchar(128) NOT NULL COMMENT &#39;tag_id&#39;,
  `app_name` varchar(128) DEFAULT NULL COMMENT &#39;app_name&#39;,
  `content` longtext NOT NULL COMMENT &#39;content&#39;,
  `md5` varchar(32) DEFAULT NULL COMMENT &#39;md5&#39;,
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,
  `src_user` text COMMENT &#39;source user&#39;,
  `src_ip` varchar(50) DEFAULT NULL COMMENT &#39;source ip&#39;,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#39;config_info_tag&#39;;

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = config_tags_relation   */
/******************************************/
CREATE TABLE `config_tags_relation` (
  `id` bigint(20) NOT NULL COMMENT &#39;id&#39;,
  `tag_name` varchar(128) NOT NULL COMMENT &#39;tag_name&#39;,
  `tag_type` varchar(64) DEFAULT NULL COMMENT &#39;tag_type&#39;,
  `data_id` varchar(255) NOT NULL COMMENT &#39;data_id&#39;,
  `group_id` varchar(128) NOT NULL COMMENT &#39;group_id&#39;,
  `tenant_id` varchar(128) DEFAULT &#39;&#39; COMMENT &#39;tenant_id&#39;,
  `nid` bigint(20) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`nid`),
  UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),
  KEY `idx_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#39;config_tag_relation&#39;;

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = group_capacity   */
/******************************************/
CREATE TABLE `group_capacity` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;主键ID&#39;,
  `group_id` varchar(128) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;Group ID，空字符表示整个集群&#39;,
  `quota` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;配额，0表示使用默认值&#39;,
  `usage` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;使用量&#39;,
  `max_size` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;单个配置大小上限，单位为字节，0表示使用默认值&#39;,
  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;聚合子配置最大个数，，0表示使用默认值&#39;,
  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#39;,
  `max_history_count` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;最大变更历史数量&#39;,
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_group_id` (`group_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#39;集群、各Group容量信息表&#39;;

/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = his_config_info   */
/******************************************/
CREATE TABLE `his_config_info` (
  `id` bigint(64) unsigned NOT NULL,
  `nid` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `data_id` varchar(255) NOT NULL,
  `group_id` varchar(128) NOT NULL,
  `app_name` varchar(128) DEFAULT NULL COMMENT &#39;app_name&#39;,
  `content` longtext NOT NULL,
  `md5` varchar(32) DEFAULT NULL,
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `src_user` text,
  `src_ip` varchar(50) DEFAULT NULL,
  `op_type` char(10) DEFAULT NULL,
  `tenant_id` varchar(128) DEFAULT &#39;&#39; COMMENT &#39;租户字段&#39;,
  PRIMARY KEY (`nid`),
  KEY `idx_gmt_create` (`gmt_create`),
  KEY `idx_gmt_modified` (`gmt_modified`),
  KEY `idx_did` (`data_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#39;多租户改造&#39;;


/******************************************/
/*   数据库全名 = nacos_config   */
/*   表名称 = tenant_capacity   */
/******************************************/
CREATE TABLE `tenant_capacity` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;主键ID&#39;,
  `tenant_id` varchar(128) NOT NULL DEFAULT &#39;&#39; COMMENT &#39;Tenant ID&#39;,
  `quota` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;配额，0表示使用默认值&#39;,
  `usage` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;使用量&#39;,
  `max_size` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;单个配置大小上限，单位为字节，0表示使用默认值&#39;,
  `max_aggr_count` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;聚合子配置最大个数&#39;,
  `max_aggr_size` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值&#39;,
  `max_history_count` int(10) unsigned NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;最大变更历史数量&#39;,
  `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,
  `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;修改时间&#39;,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#39;租户容量信息表&#39;;


CREATE TABLE `tenant_info` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;id&#39;,
  `kp` varchar(128) NOT NULL COMMENT &#39;kp&#39;,
  `tenant_id` varchar(128) default &#39;&#39; COMMENT &#39;tenant_id&#39;,
  `tenant_name` varchar(128) default &#39;&#39; COMMENT &#39;tenant_name&#39;,
  `tenant_desc` varchar(256) DEFAULT NULL COMMENT &#39;tenant_desc&#39;,
  `create_source` varchar(32) DEFAULT NULL COMMENT &#39;create_source&#39;,
  `gmt_create` bigint(20) NOT NULL COMMENT &#39;创建时间&#39;,
  `gmt_modified` bigint(20) NOT NULL COMMENT &#39;修改时间&#39;,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),
  KEY `idx_tenant_id` (`tenant_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT=&#39;tenant_info&#39;;

CREATE TABLE `users` (
`username` varchar(50) NOT NULL PRIMARY KEY,
`password` varchar(500) NOT NULL,
`enabled` boolean NOT NULL
);

CREATE TABLE `roles` (
`username` varchar(50) NOT NULL,
`role` varchar(50) NOT NULL,
UNIQUE INDEX `idx_user_role` (`username` ASC, `role` ASC) USING BTREE
);

CREATE TABLE `permissions` (
    `role` varchar(50) NOT NULL,
    `resource` varchar(255) NOT NULL,
    `action` varchar(8) NOT NULL,
    UNIQUE INDEX `uk_role_permission` (`role`,`resource`,`action`) USING BTREE
);

INSERT INTO users (username, password, enabled) VALUES (&#39;nacos&#39;, &#39;$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu&#39;, TRUE);

INSERT INTO roles (username, role) VALUES (&#39;nacos&#39;, &#39;ROLE_ADMIN&#39;);</pre>
<br />
2. 在 Nacos Server 安装目录下的 conf 文件夹中，将 cluster.conf.example 重命名为 cluster.conf，然后在该文件中添加以下内容。<br />
<pre class="info-box">
192.168.3.138:3333
192.168.3.138:4444
192.168.3.138:5555</pre>
<br />
配置说明如下：
<ul>
	<li>
		192.168.138 为本地电脑主机的 IP 地址，这里最好不要写成 localhost 或 127.0.0.1，否则 Nacos Server 集群可能会搭建失败！</li>
	<li>
		本次搭建的 Nacos Server 集群的端口分别为：3333、4444、5555。</li>
</ul>
<br />
3. 在 config 目录下的 application.properties 中，将 server.port（端口号）修改为 3333，并在该文件中添加 MySQL 数据库配置，具体修改内容如下。<br />
<pre class="info-box">
server.port=3333
################ MySQL 数据库配置##################
spring.datasource.platform=mysql

db.num=1
db.url.0=jdbc:mysql://127.0.0.1:3306/nacos_config?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=Asia/Shanghai
db.user=root
db.password=root</pre>
4. 将该 Nacos Server 目录复制到另外两台机器上，并将它们的端口号分别修改为： 4444 和 5555。<br />
<br />
5. 下载 Nginx，并修改 Nginx 中 conf 目录下的 nginx.conf 的配置，内容如下。<br />
<pre class="info-box">
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;

events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;
    upstream cluster{
        server 127.0.0.1:3333;
        server 127.0.0.1:4444;
        server 127.0.0.1:5555;
    }

    server {
        listen       1111;
        server_name  localhost;
        #charset koi8-r;
        #access_log  logs/host.access.log  main;
        location / {
            #root   html;
            #index  index.html index.htm;
            proxy_pass http://cluster;
        }
    }
}</pre>
<br />
6. 启动集群中所有的 Nacos Server，当出现以下内容时，表示 Nacos Server 启动成功。<br />
<pre class="info-box">
&quot;nacos is starting with cluster&quot;

         ,--.
       ,--.&#39;|
   ,--,:  : |                                           Nacos 2.0.3
,`--.&#39;`|  &#39; :                       ,---.               Running in cluster mode, All function modules
|   :  :  | |                      &#39;   ,&#39;\   .--.--.    Port: ****
:   |   \ | :  ,--.--.     ,---.  /   /   | /  /    &#39;   Pid: 21592
|   : &#39;  &#39;; | /       \   /     \.   ; ,. :|  :  /`./   Console: http://192.168.3.138:3333/nacos/index.html
&#39;   &#39; ;.    ;.--.  .-. | /    / &#39;&#39;   | |: :|  :  ;_
|   | | \   | \__\/: . ..    &#39; / &#39;   | .; : \  \    `.      https://nacos.io
&#39;   : |  ; .&#39; ,&quot; .--.; |&#39;   ; :__|   :    |  `----.   \
|   | &#39;`--&#39;  /  /  ,.  |&#39;   | &#39;.&#39;|\   \  /  /  /`--&#39;  /
&#39;   : |     ;  :   .&#39;   \   :    : `----&#39;  &#39;--&#39;.     /
;   |.&#39;     |  ,     .-./\   \  /            `--&#39;---&#39;
&#39;---&#39;        `--`---&#39;     `----&#39;

2021-11-09 16:25:00,993 INFO The server IP list of Nacos is [192.168.3.138:3333, 192.168.3.138:4444, 192.168.3.138:5555]

2021-11-09 16:27:07,318 INFO Nacos is starting...

2021-11-09 16:27:08,325 INFO Nacos is starting...

2021-11-09 16:27:09,340 INFO Nacos is starting...

2021-11-09 16:27:10,343 INFO Nacos is starting...

2021-11-09 16:27:10,742 INFO Nacos started successfully in cluster mode. use external storage</pre>
<br />
7. 当集群中的所有 Nacos Server 都启动成功后，双击 Nignx 安装目录下的 nginx.exe，启动 Nginx。<br />
<br />
<div style="text-align: center;">
	<img alt="Nginx " src="../uploads/allimg/211210/10225BO0-12_2.png" style="border-width: 1px; border-style: solid;" /><br />
	图13：Nginx 启动脚本</div>
<br />
8. 使用浏览器访问&ldquo;http://localhost:1111/nacos/&rdquo;，若成功访问 Nacos Server 的控制台，则说明 Nacos 集群部署成功，如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="" src="../uploads/allimg/211210/10225C554-13_2.png" /><br />
	图14：Nacos 集群</div>
<br />
9. 将主工程 spring-cloud-alibaba-demo 下所有子模块配置文件中的 Nacos Server 地址统一修改为：localhost:1111。我们以&nbsp;spring-cloud-alibaba-consumer-nacos-8801 为例，配置文件 application.yml 的配置内容如下。<br />
<pre class="xml">
server:
  port: 8801  #端口号
spring:
  application:
    name: spring-cloud-alibaba-consumer #服务名
  cloud:
    nacos:
      discovery:
        #server-addr: localhost:8848  #单机版 Nacos Server 的地址
        server-addr: localhost:1111  #集群版 Nacos Server 的地址

#以下配置信息并不是默认配置，而是我们自定义的配置，目的是不在 Controller 内硬编码服务提供者的服务名
service-url:
  nacos-user-service: http://spring-cloud-alibaba-provider #服务提供者的服务名</pre>
<br />
10. 重启 spring-cloud-alibaba-consumer-nacos-8801，并使用浏览器访问&ldquo;http://localhost:1111/nacos&rdquo;，查看&ldquo;服务管理&rdquo;下的&ldquo;服务列表&rdquo;，结果如下图。<br />
<br />
<div style="text-align: center;">
	<a href="http://new-local.weixueyuan.net/uploads/allimg/211109/6-2111091H412N8.png" target="_blank"><img alt="Nacos 集群 2" src="../uploads/allimg/211210/10225A913-14_2.png" style="border-width: 1px; border-style: solid;border-color:black;" /></a><br />
	图15：服务注册到 Nacos Server 集群上</div>
</div>
			<div id="ggxc-weixin-arcbottom">
	<p>关注公众号「<span class="col-green">站长严长生</span>」，在手机上阅读所有教程，随时随地都能学习。内含一款搜索神器，免费下载全网书籍和视频。</p>
	<p style="margin-top:12px; text-align:center;">
		<img src="../templets/new/images/material/qrcode_mp_4.png" alt="公众号二维码" width="160" /><br />
		<span class="col-green">微信扫码关注公众号</span>
	</p>
</div>
			<div class="pre-next-page clearfix">&nbsp;</div>
			<div id="nice-arcs" class="box-bottom">
    <h4>推荐阅读</h4>
    <ul class="clearfix">
<li><a href="../view/niz69i_8.html" title="一套完整的嵌入式开发学习路线（高薪就业版）" target="_blank">一套完整的嵌入式开发学习路线（高薪就业版）</a></li>
<li><a href="../view/tnnfqo_4.html" title="一套课程卖1万，TMD太贵了！" target="_blank">一套课程卖1万，TMD太贵了！</a></li>
<li><a href="../view/unnurw_4.html" title="跑了3000公里，见了一位大佬" target="_blank">跑了3000公里，见了一位大佬</a></li>
<li><a href="../view/204_2.html" title="函数的返回值，C语言函数返回值详解" target="_blank">函数的返回值，C语言函数返回值详解</a></li>
<li><a href="../view/2376_2.html" title="MySQL安装教程，包含所有平台（图解）" target="_blank">MySQL安装教程，包含所有平台（图解）</a></li>
<li><a href="../view/7291_2.html" title="MySQL设置事务自动提交（开启和关闭）" target="_blank">MySQL设置事务自动提交（开启和关闭）</a></li>
<li><a href="../numpy/array-range_2.html" title="NumPy创建区间数组" target="_blank">NumPy创建区间数组</a></li>
<li><a href="../view/eiq6xs_2.html" title="git add：向暂存区中添加文件" target="_blank">git add：向暂存区中添加文件</a></li>
<li><a href="../view/vtwb0nm_2.html" title="MySQL修改字段名" target="_blank">MySQL修改字段名</a></li>
<li><a href="../view/4twyz7x_2.html" title="HTML引用CSS的4种方法" target="_blank">HTML引用CSS的4种方法</a></li>
</ul>
</div>
		</div>
		
	</div>
</div>
<script type="text/javascript">
// 当前文章ID
window.arcIdRaw = 'a_' + 9499;
window.arcId = "9be3WUpLqrj2xApzt4zTSVtuv4p7nqegf03m3QUc293I/OVUoyxOrJ1bf8M";
window.typeidChain = "434";
</script>
<div id="footer" class="clearfix">
	<div class="info left">
	<p>精美而实用的网站，分享优质编程教程，帮助有志青年。千锤百炼，只为大作；精益求精，处处斟酌；这种教程，看一眼就倾心。</p>
	<p>
		<a href="../view/8066_2.html" target="_blank" rel="nofollow">关于网站</a> <span>|</span>
		<a href="https://m.biancheng.net/view/8092_3.html" target="_blank" rel="nofollow">关于站长</a> <span>|</span>
		<a href="https://m.biancheng.net/view/8097_2.html" target="_blank" rel="nofollow">如何完成一部教程</a> <span>|</span>
		<a href="https://m.biancheng.net/view/9648_2.html" target="_blank" rel="nofollow">公众号</a> <span>|</span>
		<a href="https://m.biancheng.net/view/8093_2.html" target="_blank" rel="nofollow">联系我们</a> <span>|</span>
		<a href="https://m.biancheng.net/sitemap/sitemap_2.html" target="_blank" rel="nofollow">网站地图</a>
	</p>
	<p>Copyright ©2012-2022 biancheng.net, <a href="https://beian.miit.gov.cn" target="_blank" rel="nofollow" style="color:#666;">冀ICP备2022013920号</a>, <img height="13" src="https://m.biancheng.net/templets/new/images/gongan_2.png" alt="公安备案图标" /><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=13110202001352" target="_blank" rel="nofollow" style="color:#666;">冀公网安备13110202001352号</a>
	</p>
	</div>
	<img id="logo_bottom" class="right" src="https://m.biancheng.net/templets/new/images/logo_bottom_2.gif" alt="底部Logo" />
	<span id="return-top"><b>↑</b></span>
</div>

<div id="addweixin-widget">
	<p>
		<script type="text/javascript">
			/*var suffix = 'c';
			var thisMin = (new Date()).getMinutes();
			if(thisMin>=40){
				suffix = 'd';
			}else if(thisMin>=20){
				suffix = 'e';
			}else{
				suffix = 'c';
			}
			document.write('<img src="https://m.biancheng.net/templets/new/images/material/qrcode_wx_'%20+%20suffix%20+'.png?v=1.7.07" alt="微信交流群" width="120" /><br />');*/
		</script>
		<img src="https://m.biancheng.net/templets/new/images/material/qrcode_mp_4.png" alt="微信交流群" width="120" />
		<span>关注微信公众号，加入官方交流群。内含一款搜索神器，免费下载全网书籍和视频。</span>
	</p>
	<span id="close-addweixin-widget" class="iconfont iconfont-close"></span>
</div>

<script type="text/javascript">
window.siteId = 4;
window.cmsTemplets = "/templets/new";
window.cmsTempletsVer = "1.7.07";
window.prePageURL = "/springcloud/what-is-alibaba.html";
window.nextPageURL = "/springcloud/sentinel.html";
</script>

<script src="https://m.biancheng.net/templets/new/script/jquery1.12.4.min_2.js"></script>
<script src="https://m.biancheng.net/templets/new/script/common_2.js"></script>
<!-- 51la V6 -->
<span style="display: none;">
<script charset="UTF-8" id="LA_COLLECT" src="https://sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id:"KDf6QzBhogyQjall",ck:"KDf6QzBhogyQjall",autoTrack:true})</script>
</span>
<!-- 51la V5 -->
<!-- <span style="display: none;"><script type="text/javascript" src="https://js.users.51.la/21368967.js"></script></span> -->
</body>
</html>