<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
<!-- 启用Chromium高速渲染模式 -->
<meta name="renderer" content="webkit" />
<meta name="force-rendering" content="webkit"/>
<!-- 禁止百度转码 -->
<meta name="applicable-device" content="pc,mobile" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!-- 禁止识别电话号码 -->
<meta name="format-detection" content="telephone=no" />

<link rel="shortcut icon" href="../favicon_3.ico" />
<link href="../templets/new/style/common_2.css" rel="stylesheet" />
<title>OpenFeign：Spring Cloud声明式服务调用组件（非常详细）</title>
<meta name="description" content="Netflix Feign 是 Netflix 公司发布的一种实现负载均衡和服务调用的开源组件。Spring Cloud 将其与 Netflix 中的其他开源服务组件（例如 Eureka、Ribbon 以及 Hystrix 等）一起整合进 Spring Cloud Netfli" />
</head>
<body>
<div id="topbar" class="clearfix">
	<ul id="product-type" class="left">
		<li>
			<a href="../m_biancheng_default_2.html"><span class="iconfont iconfont-home"></span>首页</a>
		</li>
		<li class="active">
			<a href="../sitemap/sitemap_2.html" rel="nofollow"><span class="iconfont iconfont-book"></span>教程</a>
		</li>
		<li>
			<a href="http://vip.biancheng.net/p/vip/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-vip"></span>VIP会员</a>
		</li>
		<li>
			<a href="../fudao_biancheng_default.html" rel="nofollow" target="_blank"><span class="iconfont iconfont-fudao"></span>辅导班</a>
		</li>
		<li>
			<a href="../view/niz69i_5.html" target="_blank"><span class="iconfont iconfont-chip"></span>嵌入式学习路线</a>
		</li>
		<!-- <li>
			<a href="https://www.54benniao.com/c_course/?from=biancheng" target="_blank"><span class="iconfont iconfont-c-course"></span>C语言高级课程</a>
		</li>
		<li>
			<a href="https://www.54benniao.com/java_course/?from=biancheng" target="_blank"><span class="iconfont iconfont-java-course"></span>Java高级课程</a>
		</li>
		<li>
			<a href="http://vip.biancheng.net/p/q2a/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-q2a"></span>一对一答疑</a>
		</li> -->
	</ul>
</div>
<div id="header" class="clearfix">
	<a id="logo" class="left" href="../m_biancheng_default_2.html">
		<img height="26" src="../templets/new/images/logo_2.png" alt="C语言中文网" />
	</a>
	<ul id="nav-main" class="hover-none left clearfix">
		<li class="wap-yes"><a href="../m_biancheng_default_2.html">首页</a></li>
		<li><a href="../c/c_4.html">C语言教程</a></li>
		<li><a href="../cplus/cplus_2.html">C++教程</a></li>
		<li><a href="../python/python_2.html">Python教程</a></li>
		<li><a href="../java/java_2.html">Java教程</a></li>
		<li><a href="../linux_tutorial/linux_tutorial_2.html">Linux入门</a></li>
		<li><a href="../sitemap/sitemap_2.html" title="网站地图">更多&gt;&gt;</a></li>
	</ul>
	<span id="sidebar-toggle" class="toggle-btn" toggle-target="#sidebar">目录 <span class="iconfont"></span></span>

	<a href="http://vip.biancheng.net/?from=topbar" class="user-info iconfont iconfont-user hover-none" target="_blank" rel="nofollow" title="用户中心"></a>
</div>
<div id="main" class="clearfix">
	<div id="sidebar" class="toggle-target">
	<div id="contents">
		<dt><span class="iconfont iconfont-list-vertical" aria-hidden="true"></span><a href="springcloud_2.html">Spring Cloud</a></dt>
		<dd>
        	<span class="channel-num">1</span>
        	<a href="micro-service_2.html">微服务是什么</a>
        </dd>
<dd>
        	<span class="channel-num">2</span>
        	<a href="what-is-cloud_2.html">Spring Cloud是什么</a>
        </dd>
<dd>
        	<span class="channel-num">3</span>
        	<a href="eureka_2.html">Spring Cloud Eureka</a>
        </dd>
<dd>
        	<span class="channel-num">4</span>
        	<a href="ribbon_2.html">Spring Cloud Ribbon</a>
        </dd>
<dd>
        	<span class="channel-num">5</span>
        	<a href="open-feign_2.html">Spring Cloud OpenFeign</a>
        </dd>
<dd>
        	<span class="channel-num">6</span>
        	<a href="hystrix_2.html">Spring Cloud Hystrix</a>
        </dd>
<dd>
        	<span class="channel-num">7</span>
        	<a href="gateway_2.html">Spring Cloud Gateway</a>
        </dd>
<dd>
        	<span class="channel-num">8</span>
        	<a href="config_2.html">Spring Cloud Config</a>
        </dd>
<dd>
        	<span class="channel-num">9</span>
        	<a href="what-is-alibaba_2.html">Spring Cloud Alibaba是什么</a>
        </dd>
<dd>
        	<span class="channel-num">10</span>
        	<a href="nacos_2.html">Spring Cloud Alibaba Nacos</a>
        </dd>
<dd>
        	<span class="channel-num">11</span>
        	<a href="sentinel_2.html">Spring Cloud Alibaba Sentinel</a>
        </dd>
<dd>
        	<span class="channel-num">12</span>
        	<a href="seata_2.html">Spring Cloud Alibaba Seata</a>
        </dd>

	</div>
</div>
	<div id="article-wrap">
		<div id="article">
			<div class="arc-info">
	<span class="position"><span class="iconfont iconfont-home2"></span> <a href="../m_biancheng_default_2.html">首页</a> &gt; <a href="springcloud_2.html">Spring Cloud</a></span>
</div>

<div id="ggxc-position-bottom" class="ggxc-box"></div>
			<h1>OpenFeign：Spring Cloud声明式服务调用组件（非常详细）</h1>
			<div class="pre-next-page clearfix">&nbsp;</div>
			<div id="ggxc-arctop-pc-1" class="ggxc-box"></div>
			<div id="arc-body">Netflix Feign 是 Netflix 公司发布的一种实现负载均衡和服务调用的开源组件。Spring Cloud 将其与 Netflix 中的其他开源服务组件（例如 Eureka、Ribbon 以及 Hystrix 等）一起整合进 Spring Cloud Netflix 模块中，整合后全称为 Spring Cloud Netflix Feign。<br />
&nbsp;<br />
Feign 对&nbsp;<a href="ribbon_2.html" target="_blank">Ribbon</a>&nbsp;进行了集成，利用 Ribbon 维护了一份可用服务清单，并通过 Ribbon 实现了客户端的负载均衡。<br />
<br />
Feign 是一种声明式服务调用组件，它在 RestTemplate 的基础上做了进一步的封装。通过 Feign，我们只需要声明一个接口并通过注解进行简单的配置（类似于 Dao 接口上面的 Mapper 注解一样）即可实现对 HTTP 接口的绑定。<br />
<br />
通过 Feign，我们可以像调用本地方法一样来调用远程服务，而完全感觉不到这是在进行远程调用。<br />
<br />
Feign 支持多种注解，例如 Feign 自带的注解以及 JAX-RS 注解等，但遗憾的是 Feign 本身并不支持 Spring MVC 注解，这无疑会给广大 Spring 用户带来不便。<br />
<br />
2019 年 Netflix 公司宣布 Feign 组件正式进入停更维护状态，于是 Spring 官方便推出了一个名为 OpenFeign 的组件作为 Feign 的替代方案。
<h2>
	OpenFeign</h2>
OpenFeign 全称 Spring Cloud OpenFeign，它是 Spring 官方推出的一种声明式服务调用与负载均衡组件，它的出现就是为了替代进入停更维护状态的 Feign。<br />
<br />
OpenFeign 是 Spring Cloud 对 Feign 的二次封装，它具有 Feign 的所有功能，并在 Feign 的基础上增加了对 Spring MVC 注解的支持，例如 @RequestMapping、@GetMapping 和 @PostMapping 等。<br />
<h4>
	OpenFeign 常用注解</h4>
使用 OpenFegin 进行远程服务调用时，常用注解如下表。&nbsp;<br />
<br />
<table>
	<tbody>
		<tr>
			<th>
				注解</th>
			<th>
				说明</th>
		</tr>
		<tr>
			<td>
				@FeignClient&nbsp;</td>
			<td>
				该注解用于通知 OpenFeign 组件对 @RequestMapping 注解下的接口进行解析，并通过动态代理的方式产生实现类，实现负载均衡和服务调用。</td>
		</tr>
		<tr>
			<td>
				@EnableFeignClients</td>
			<td>
				该注解用于开启 OpenFeign 功能，当 Spring Cloud 应用启动时，OpenFeign 会扫描标有 @FeignClient 注解的接口，生成代理并注册到 Spring 容器中。</td>
		</tr>
		<tr>
			<td>
				@RequestMapping</td>
			<td>
				Spring MVC 注解，在 Spring MVC 中使用该注解映射请求，通过它来指定控制器（Controller）可以处理哪些 URL 请求，相当于 Servlet 中&nbsp;web.xml 的配置。</td>
		</tr>
		<tr>
			<td>
				@GetMapping</td>
			<td>
				Spring MVC 注解，用来映射 GET 请求，它是一个组合注解，相当于 @RequestMapping(method = RequestMethod.GET) 。</td>
		</tr>
		<tr>
			<td>
				@PostMapping</td>
			<td>
				Spring MVC 注解，用来映射 POST 请求，它是一个组合注解，相当于 @RequestMapping(method = RequestMethod.POST)&nbsp;。</td>
		</tr>
	</tbody>
</table>
<blockquote>
	<p>
		Spring Cloud&nbsp;Finchley 及以上版本一般使用 OpenFeign 作为其服务调用组件。由于 OpenFeign 是在 2019 年 Feign 停更进入维护后推出的，因此大多数 2019 年及以后的新项目使用的都是 OpenFeign，而 2018 年以前的项目一般使用 Feign。</p>
</blockquote>
<h2>
	Feign VS OpenFeign&nbsp;</h2>
下面我们就来对比下 Feign 和 OpenFeign 的异同。
<h4>
	相同点</h4>
Feign 和 OpenFegin 具有以下相同点：
<ul>
	<li>
		Feign 和 OpenFeign&nbsp;都是 Spring Cloud 下的远程调用和负载均衡组件。</li>
	<li>
		Feign 和 OpenFeign 作用一样，都可以实现服务的远程调用和负载均衡。</li>
	<li>
		Feign 和 OpenFeign 都对&nbsp;Ribbon 进行了集成，都利用&nbsp;Ribbon 维护了可用服务清单，并通过 Ribbon 实现了客户端的负载均衡。</li>
	<li>
		Feign 和 OpenFeign 都是在服务消费者（客户端）定义服务绑定接口并通过注解的方式进行配置，以实现远程服务的调用。</li>
</ul>
<h4>
	不同点</h4>
Feign 和 OpenFeign 具有以下不同：
<ul>
	<li>
		Feign 和 OpenFeign 的依赖项不同，Feign 的依赖为&nbsp;spring-cloud-starter-feign，而 OpenFeign 的依赖为&nbsp;spring-cloud-starter-openfeign。</li>
	<li>
		Feign 和 OpenFeign 支持的注解不同，Feign 支持 Feign 注解和 JAX-RS 注解，但不支持 Spring MVC 注解；OpenFeign 除了支持&nbsp;Feign 注解和 JAX-RS 注解外，还支持 Spring MVC 注解。</li>
</ul>
<h2>
	OpenFeign 实现远程服务调用</h2>
下面我们就通过一个实例，来演示下通过 OpenFeign 是如何实现远程服务调用的。<br />
<br />
1. 在&nbsp;spring-cloud-demo2 下创建一个名为&nbsp;micro-service-cloud-consumer-dept-feign 的 Spring Boot 模块，并在 pom.xml 中添加以下依赖。
<pre class="xml">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;artifactId&gt;spring-cloud-demo2&lt;/artifactId&gt;
        &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;
        &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;/parent&gt;

    &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;
    &lt;artifactId&gt;micro-service-cloud-consumer-dept-feign&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;micro-service-cloud-consumer-dept-feign&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    &lt;properties&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.biancheng.c&lt;/groupId&gt;
            &lt;artifactId&gt;micro-service-cloud-api&lt;/artifactId&gt;
            &lt;version&gt;${project.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!--Eureka Client 依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-eureka-client&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!-- Ribbon 依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-netflix-ribbon&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;!--添加 OpenFeign 依赖--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
            &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</pre>
<br />
2. 在&nbsp;micro-service-cloud-consumer-dept-feign 下的类路径（即 /resources 目录）下，添加一个 application.yml，配置内容如下。
<pre class="xml">
server:
  port: 80

eureka:
  client:
    register-with-eureka: false #服务消费者可以不向服务注册中心注册服务
    service-url:
      defaultZone: http://eureka7001.com:7001/eureka/,http://eureka7002.com:7002/eureka/,http://eureka7003.com:7003/eureka/
    fetch-registry: true  #服务消费者客户端需要去检索服务</pre>
<br />
3. 在 net.biancheng.c.service 包下创建一个名为&nbsp;DeptFeignService 的接口，并在该接口上使用&nbsp;@FeignClient 注解实现对服务接口的绑定，代码如下。
<pre class="java">
package net.biancheng.c.service;

import net.biancheng.c.entity.Dept;
import org.springframework.cloud.openfeign.FeignClient;
import org.springframework.stereotype.Component;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;

import java.util.List;

//添加为容器内的一个组件
@Component
// 服务提供者提供的服务名称，即 application.name
@FeignClient(value = &quot;MICROSERVICECLOUDPROVIDERDEPT&quot;)
public interface DeptFeignService {
    //对应服务提供者（8001、8002、8003）Controller 中定义的方法
    @RequestMapping(value = &quot;/dept/get/{id}&quot;, method = RequestMethod.GET)
    public Dept get(@PathVariable(&quot;id&quot;) int id);

    @RequestMapping(value = &quot;/dept/list&quot;, method = RequestMethod.GET)
    public List&lt;Dept&gt; list();
}</pre>
<br />
在编写服务绑定接口时，需要注意以下 2 点：
<ul>
	<li>
		在 @FeignClient&nbsp;注解中，value 属性的取值为：服务提供者的服务名，即服务提供者配置文件（application.yml）中&nbsp;spring.application.name 的取值。</li>
	<li>
		接口中定义的每个方法都与服务提供者（即 micro-service-cloud-provider-dept-8001 等）中 Controller 定义的服务方法对应。</li>
</ul>
<br />
4. 在&nbsp;net.biancheng.c.controller 包下，创建一个名为&nbsp;DeptController_Consumer 的 Controller 类，代码如下。
<pre class="java">
package net.biancheng.c.controller;

import net.biancheng.c.entity.Dept;
import net.biancheng.c.service.DeptFeignService;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import javax.annotation.Resource;
import java.util.List;

@RestController
public class DeptController_Consumer {
    
    @Resource
    private DeptFeignService deptFeignService;

    @RequestMapping(value = &quot;/consumer/dept/get/{id}&quot;)
    public Dept get(@PathVariable(&quot;id&quot;) Integer id) {
        return deptFeignService.get(id);
    }

    @RequestMapping(value = &quot;/consumer/dept/list&quot;)
    public List&lt;Dept&gt; list() {
        return deptFeignService.list();
    }
}</pre>
<br />
5. 在主启动类上添加&nbsp;@EnableFeignClients 注解开启 OpenFeign 功能，代码如下。
<pre class="java">
package net.biancheng.c;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.openfeign.EnableFeignClients;

@SpringBootApplication
@EnableFeignClients //开启 OpenFeign 功能
public class MicroServiceCloudConsumerDeptFeignApplication {

    public static void main(String[] args) {
        SpringApplication.run(MicroServiceCloudConsumerDeptFeignApplication.class, args);
    }
}</pre>
<br />
Spring Cloud 应用在启动时，OpenFeign 会扫描标有 @FeignClient 注解的接口生成代理，并注人到 Spring 容器中。<br />
<br />
6. 依次启动服务注册中心集群、服务提供者以及 micro-service-cloud-consumer-dept-feign，启动完成后，使用浏览器访问&ldquo;http://eureka7001.com/consumer/dept/list&rdquo;，结果如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="OpenFeign 实现服务调用" src="../uploads/allimg/211210/1014296212-0_2.png" /><br />
	图1：OpenFeign 实现远程服务调用</div>
<br />
7. 连续多次访问&ldquo;http://eureka7001.com/consumer/dept/list&rdquo;，结果如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="OpenFeign 默认负载均衡" src="../uploads/allimg/211210/1014294062-1_2.gif" /><br />
	图2：OpenFeign 负载均衡</div>
<br />
从图 2 可以看出，由于 OpenFeign 集成了 Ribbon，因此它也实现了客户端的负载均衡，其默认负载均衡策略为轮询策略。
<h2>
	OpenFeign 超时控制</h2>
OpenFeign 客户端的默认超时时间为 1 秒钟，如果服务端处理请求的时间超过 1 秒就会报错。为了避免这样的情况，我们需要对 OpenFeign 客户端的超时时间进行控制。<br />
<br />
下面我们就通过一个实例，来演示 OpenFeign 是如何进行超时控制的。<br />
<br />
1. 在所有的服务提供者（服务端）的&nbsp;DeptController 中添加一个响应时间为 5 秒的服务，代码如下。
<pre class="java">
//超时测试,该服务的响应时间为 5 秒
@RequestMapping(value = &quot;/dept/feign/timeout&quot;)
public String DeptFeignTimeout() {
    //暂停 5 秒
    try {
        TimeUnit.SECONDS.sleep(5);
    } catch (InterruptedException e) {
        e.printStackTrace();
    }
    return serverPort;
}</pre>
<br />
2. 在&nbsp;micro-service-cloud-consumer-dept-feign 的 DeptFeignService 接口中添加以下代码，绑定服务端刚刚添加的超时服务。
<pre class="java">
@RequestMapping(value = &quot;/dept/feign/timeout&quot;)
public String DeptFeignTimeout();</pre>
<br />
3. 在&nbsp;micro-service-cloud-consumer-dept-feign 的&nbsp;DeptController_Consumer 添加以下代码。
<pre class="java">
@RequestMapping(value = &quot;/consumer/dept/feign/timeout&quot;)
public String DeptFeignTimeout() {
    // openFeign-ribbon 客户端一般默认等待一秒钟，超过该时间就会报错
    return deptFeignService.DeptFeignTimeout();
}</pre>
<br />
4. 重启所有服务提供者，使用浏览器依次访问&ldquo;http://eureka7001.com:8001/dept/feign/timeout&rdquo;、&ldquo;http://eureka7001.com:8002/dept/feign/timeout&rdquo;和&ldquo;http://eureka7001.com:8003/dept/feign/timeout&rdquo;，确保所有服务提供者提供的超时服务都能正常使用，如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="服务提供者超时服务" src="../uploads/allimg/211210/10142a102-2_2.png" /><br />
	图3：服务提供者的超时服务</div>
<br />
5. 重启&nbsp;micro-service-cloud-consumer-dept-feign，使用浏览器访问&ldquo;http://eureka7001.com/consumer/dept/feign/timeout&rdquo;，结果如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="OpenFeign 超时报错" src="../uploads/allimg/211210/1014293G1-3_2.png" /><br />
	图4：OpenFeign 超时报错</div>
<br />
6. 在 micro-service-cloud-consumer-dept-feign 的 application.yml 中添加以下配置，将超时时间设置为 6 秒。<br />
<pre class="xml">
ribbon:
  ReadTimeout: 6000 #建立连接所用的时间，适用于网络状况正常的情况下，两端两端连接所用的时间
  ConnectionTimeout: 6000 #建立连接后，服务器读取到可用资源的时间</pre>
<blockquote>
	<p>
		注：由于 OpenFeign 集成了 Ribbon ，其服务调用以及负载均衡在底层都是依靠 Ribbon 实现的，因此 OpenFeign 超时控制也是通过 Ribbon 来实现的。</p>
</blockquote>
7. 再次重启 micro-service-cloud-consumer-dept-feign，使用浏览器访问&ldquo;http://eureka7001.com/consumer/dept/feign/timeout&rdquo;，结果如下图。<br />
<br />
<div style="text-align: center;">
	<img alt="OpenFeign 超时控制" src="../uploads/allimg/211210/10142942D-4_2.png" /><br />
	图5：OpenFeign 超时控制</div>
<h2>
	OpenFeign 日志增强</h2>
OpenFeign 提供了日志打印功能，我们可以通过配置调整日志级别，来了解请求的细节。<br />
<br />
Feign 为每一个 FeignClient 都提供了一个 feign.Logger 实例，通过它可以对 OpenFeign 服务绑定接口的调用情况进行监控。<br />
<br />
OpenFeign 日志打印功能的开启方式比较简单，下面我们就通过一个实例进行演示。<br />
<br />
1. 在 micro-service-cloud-consumer-dept-feign 的 application.yml 中配置以下内容。
<pre class="xml">
logging:
  level:
    #feign 日志以什么样的级别监控该接口
    net.biancheng.c.service.DeptFeignService: debug</pre>
<br />
以上配置说明如下：
<ul>
	<li>
		net.biancheng.c.service.DeptFeignService 是开启 @FeignClient 注解的接口（即服务绑定接口）的完整类名。也可以只配置部分路径，表示监控该路径下的所有服务绑定接口</li>
	<li>
		debug：表示监听该接口的日志级别。</li>
</ul>
<br />
以上配置的含义就是，OpenFeign 以 debug 级别监控&nbsp;net.biancheng.c.service.DeptFeignService 接口。<br />
<br />
2.&nbsp;在 net.biancheng.c.&nbsp;config 包下创建一个名为 ConfigBean 的配置类，代码如下。
<pre class="java">
package net.biancheng.c.config;

import feign.Logger;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class ConfigBean {
    /**
     * OpenFeign 日志增强
     * 配置 OpenFeign 记录哪些内容
     */
    @Bean
    Logger.Level feginLoggerLevel() {
        return Logger.Level.FULL;
    }
}</pre>
<br />
该配置的作用是通过配置的 Logger.Level 对象告诉 OpenFeign 记录哪些日志内容。<br />
<br />
&nbsp;Logger.Level 的具体级别如下：
<ul>
	<li>
		NONE：不记录任何信息。</li>
	<li>
		BASIC：仅记录请求方法、URL 以及响应状态码和执行时间。</li>
	<li>
		HEADERS：除了记录 BASIC 级别的信息外，还会记录请求和响应的头信息。</li>
	<li>
		FULL：记录所有请求与响应的明细，包括头信息、请求体、元数据等等。</li>
</ul>
<br />
3. 重启&nbsp;micro-service-cloud-consumer-dept-feign，使用浏览器访问&ldquo;http://eureka7001.com/consumer/dept/list&rdquo;，控制台输出如下。
<pre class="info-box">
2021-10-12 14:33:07.408 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list] ---&gt; GET http://MICROSERVICECLOUDPROVIDERDEPT/dept/list HTTP/1.1
2021-10-12 14:33:07.408 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list] ---&gt; END HTTP (0-byte body)
2021-10-12 14:33:07.983 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list] &lt;--- HTTP/1.1 200 (574ms)
2021-10-12 14:33:07.983 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list] connection: keep-alive
2021-10-12 14:33:07.983 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list] content-type: application/json
2021-10-12 14:33:07.983 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list] date: Tue, 12 Oct 2021 06:33:07 GMT
2021-10-12 14:33:07.983 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list] keep-alive: timeout=60
2021-10-12 14:33:07.983 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list] transfer-encoding: chunked
2021-10-12 14:33:07.983 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list]
2021-10-12 14:33:07.991 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list] [{&quot;deptNo&quot;:1,&quot;deptName&quot;:&quot;开发部&quot;,&quot;dbSource&quot;:&quot;bianchengbang_jdbc&quot;},{&quot;deptNo&quot;:2,&quot;deptName&quot;:&quot;人事部&quot;,&quot;dbSource&quot;:&quot;bianchengbang_jdbc&quot;},{&quot;deptNo&quot;:3,&quot;deptName&quot;:&quot;财务部&quot;,&quot;dbSource&quot;:&quot;bianchengbang_jdbc&quot;},{&quot;deptNo&quot;:4,&quot;deptName&quot;:&quot;市场部&quot;,&quot;dbSource&quot;:&quot;bianchengbang_jdbc&quot;},{&quot;deptNo&quot;:5,&quot;deptName&quot;:&quot;运维部&quot;,&quot;dbSource&quot;:&quot;bianchengbang_jdbc&quot;}]
2021-10-12 14:33:07.991 DEBUG 13388 --- [p-nio-80-exec-2] n.biancheng.c.service.DeptFeignService   : [DeptFeignService#list] &lt;--- END HTTP (341-byte body)</pre>
</div>
			<div id="ggxc-weixin-arcbottom">
	<p>关注公众号「<span class="col-green">站长严长生</span>」，在手机上阅读所有教程，随时随地都能学习。内含一款搜索神器，免费下载全网书籍和视频。</p>
	<p style="margin-top:12px; text-align:center;">
		<img src="../templets/new/images/material/qrcode_mp_4.png" alt="公众号二维码" width="160" /><br />
		<span class="col-green">微信扫码关注公众号</span>
	</p>
</div>
			<div class="pre-next-page clearfix">&nbsp;</div>
			<div id="nice-arcs" class="box-bottom">
    <h4>推荐阅读</h4>
    <ul class="clearfix">
<li><a href="../view/niz69i_8.html" title="一套完整的嵌入式开发学习路线（高薪就业版）" target="_blank">一套完整的嵌入式开发学习路线（高薪就业版）</a></li>
<li><a href="../view/tnnfqo_4.html" title="一套课程卖1万，TMD太贵了！" target="_blank">一套课程卖1万，TMD太贵了！</a></li>
<li><a href="../view/unnurw_4.html" title="跑了3000公里，见了一位大佬" target="_blank">跑了3000公里，见了一位大佬</a></li>
<li><a href="../view/2172_2.html" title="Python变量命名规则（超级详细）" target="_blank">Python变量命名规则（超级详细）</a></li>
<li><a href="../view/4674_2.html" title="C语言经典视频教程汇总，看了无师自通（共18套）" target="_blank">C语言经典视频教程汇总，看了无师自通（共18套）</a></li>
<li><a href="../view/5798_2.html" title="JS实现倒计时功能" target="_blank">JS实现倒计时功能</a></li>
<li><a href="../view/vip_7649_2.html" title="为什么要学Linux，它比Windows好在哪里？" target="_blank">为什么要学Linux，它比Windows好在哪里？</a></li>
<li><a href="../css3/border_2.html" title="CSS边框样式（border）" target="_blank">CSS边框样式（border）</a></li>
<li><a href="../view/9480_2.html" title="SaaS模式到底是什么？" target="_blank">SaaS模式到底是什么？</a></li>
<li><a href="../spring/bean-definition_2.html" title="Spring Bean定义" target="_blank">Spring Bean定义</a></li>
</ul>
</div>
		</div>
		
	</div>
</div>
<script type="text/javascript">
// 当前文章ID
window.arcIdRaw = 'a_' + 9494;
window.arcId = "5bf1KTDwF/yUBFwGnhs0r55LDlO/SC2YxDeb0PaSG60f7u9xR2jeghK98Ts";
window.typeidChain = "434";
</script>
<div id="footer" class="clearfix">
	<div class="info left">
	<p>精美而实用的网站，分享优质编程教程，帮助有志青年。千锤百炼，只为大作；精益求精，处处斟酌；这种教程，看一眼就倾心。</p>
	<p>
		<a href="../view/8066_2.html" target="_blank" rel="nofollow">关于网站</a> <span>|</span>
		<a href="../view/8092_3.html" target="_blank" rel="nofollow">关于站长</a> <span>|</span>
		<a href="../view/8097_2.html" target="_blank" rel="nofollow">如何完成一部教程</a> <span>|</span>
		<a href="../view/9648_2.html" target="_blank" rel="nofollow">公众号</a> <span>|</span>
		<a href="../view/8093_2.html" target="_blank" rel="nofollow">联系我们</a> <span>|</span>
		<a href="../sitemap/sitemap_2.html" target="_blank" rel="nofollow">网站地图</a>
	</p>
	<p>Copyright ©2012-2022 biancheng.net, <a href="https://beian.miit.gov.cn" target="_blank" rel="nofollow" style="color:#666;">冀ICP备2022013920号</a>, <img height="13" src="../templets/new/images/gongan_2.png" alt="公安备案图标" /><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=13110202001352" target="_blank" rel="nofollow" style="color:#666;">冀公网安备13110202001352号</a>
	</p>
	</div>
	<img id="logo_bottom" class="right" src="https://m.biancheng.net/templets/new/images/logo_bottom_2.gif" alt="底部Logo" />
	<span id="return-top"><b>↑</b></span>
</div>

<div id="addweixin-widget">
	<p>
		<script type="text/javascript">
			/*var suffix = 'c';
			var thisMin = (new Date()).getMinutes();
			if(thisMin>=40){
				suffix = 'd';
			}else if(thisMin>=20){
				suffix = 'e';
			}else{
				suffix = 'c';
			}
			document.write('<img src="https://m.biancheng.net/templets/new/images/material/qrcode_wx_'%20+%20suffix%20+'.png?v=1.7.07" alt="微信交流群" width="120" /><br />');*/
		</script>
		<img src="https://m.biancheng.net/templets/new/images/material/qrcode_mp_4.png" alt="微信交流群" width="120" />
		<span>关注微信公众号，加入官方交流群。内含一款搜索神器，免费下载全网书籍和视频。</span>
	</p>
	<span id="close-addweixin-widget" class="iconfont iconfont-close"></span>
</div>

<script type="text/javascript">
window.siteId = 4;
window.cmsTemplets = "/templets/new";
window.cmsTempletsVer = "1.7.07";
window.prePageURL = "/springcloud/ribbon.html";
window.nextPageURL = "/springcloud/hystrix.html";
</script>

<script src="https://m.biancheng.net/templets/new/script/jquery1.12.4.min_2.js"></script>
<script src="https://m.biancheng.net/templets/new/script/common_2.js"></script>
<!-- 51la V6 -->
<span style="display: none;">
<script charset="UTF-8" id="LA_COLLECT" src="https://sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id:"KDf6QzBhogyQjall",ck:"KDf6QzBhogyQjall",autoTrack:true})</script>
</span>
<!-- 51la V5 -->
<!-- <span style="display: none;"><script type="text/javascript" src="https://js.users.51.la/21368967.js"></script></span> -->
</body>
</html>