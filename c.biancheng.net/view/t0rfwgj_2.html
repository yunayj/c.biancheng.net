<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
<!-- 启用Chromium高速渲染模式 -->
<meta name="renderer" content="webkit" />
<meta name="force-rendering" content="webkit"/>
<!-- 禁止百度转码 -->
<meta name="applicable-device" content="pc,mobile" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!-- 禁止识别电话号码 -->
<meta name="format-detection" content="telephone=no" />

<link rel="shortcut icon" href="../favicon_3.ico" />
<link href="../templets/new/style/common_2.css" rel="stylesheet" />
<title>Python requests库详解</title>
<meta name="description" content="requests 库是一个功能更加强大的网络请求库，其在模拟登录、使用代理 IP 等方面均比 urllib 库更加方便，进而可以节约大量的工作时间，帮助程序员更加方便地对所需要的网页信息进行" />
</head>
<body>
<div id="topbar" class="clearfix">
	<ul id="product-type" class="left">
		<li>
			<a href="../m_biancheng_default_2.html"><span class="iconfont iconfont-home"></span>首页</a>
		</li>
		<li class="active">
			<a href="../sitemap/sitemap_2.html" rel="nofollow"><span class="iconfont iconfont-book"></span>教程</a>
		</li>
		<li>
			<a href="http://vip.biancheng.net/p/vip/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-vip"></span>VIP会员</a>
		</li>
		<li>
			<a href="../fudao_biancheng_default.html" rel="nofollow" target="_blank"><span class="iconfont iconfont-fudao"></span>辅导班</a>
		</li>
		<li>
			<a href="niz69i_5.html" target="_blank"><span class="iconfont iconfont-chip"></span>嵌入式学习路线</a>
		</li>
		<!-- <li>
			<a href="https://www.54benniao.com/c_course/?from=biancheng" target="_blank"><span class="iconfont iconfont-c-course"></span>C语言高级课程</a>
		</li>
		<li>
			<a href="https://www.54benniao.com/java_course/?from=biancheng" target="_blank"><span class="iconfont iconfont-java-course"></span>Java高级课程</a>
		</li>
		<li>
			<a href="http://vip.biancheng.net/p/q2a/show.php" rel="nofollow" target="_blank"><span class="iconfont iconfont-q2a"></span>一对一答疑</a>
		</li> -->
	</ul>
</div>
<div id="header" class="clearfix">
	<a id="logo" class="left" href="../m_biancheng_default_2.html">
		<img height="26" src="../templets/new/images/logo_2.png" alt="C语言中文网" />
	</a>
	<ul id="nav-main" class="hover-none left clearfix">
		<li class="wap-yes"><a href="../m_biancheng_default_2.html">首页</a></li>
		<li><a href="../c/c_4.html">C语言教程</a></li>
		<li><a href="../cplus/cplus_2.html">C++教程</a></li>
		<li><a href="../python/python_2.html">Python教程</a></li>
		<li><a href="../java/java_2.html">Java教程</a></li>
		<li><a href="../linux_tutorial/linux_tutorial_2.html">Linux入门</a></li>
		<li><a href="../sitemap/sitemap_2.html" title="网站地图">更多&gt;&gt;</a></li>
	</ul>
	<a href="http://vip.biancheng.net/?from=topbar" class="user-info iconfont iconfont-user hover-none" target="_blank" rel="nofollow" title="用户中心"></a>
</div>
<div id="main-no-course" class="clearfix">
	<div class="arc-info">
		<span class="position"><span class="iconfont iconfont-home2"></span> <a href="../m_biancheng_default_2.html">首页</a> &gt; 编程笔记</span>
	</div>
	<div id="ggxc-position-bottom" class="ggxc-box"></div>
	<h1>Python requests库详解</h1>
	<div id="ggxc-arctop-pc-1" class="ggxc-box"></div>
	<div id="arc-body">requests 库是一个功能更加强大的网络请求库，其在模拟登录、使用代理 IP 等方面均比 urllib 库更加方便，进而可以节约大量的工作时间，帮助程序员更加方便地对所需要的网页信息进行爬取。<br />
<br />
由于 requests 库属于 Python 的第三方库，所以需要进行安装，只需在命令提示符中输入命令<code>pip install requests</code>。<br />
<h2>
	1、发送HTTP请求</h2>
可以通过 requests 库中的 get() 函数和 post() 函数发送 HTTP 请求。<br />
<h4>
	1) get()函数</h4>
该函数表示使用 GET 方法发起 HTTP 请求，并返回 Response 对象，其语法格式如下：<br />
<pre>
get(url,params,headers)</pre>
其中，参数 url 表示请求 URL；参数 params 表示 GET 方法的请求参数；参数 headers 表示请求头的信息。<br />
<br />
此外，通过 Response 对象的相关属性和方法可以获取所需的数据，具体如下表所示。<br />
<br />
<table>
	<caption>
		表 1 Response对象的相关属性和方法</caption>
	<tbody>
		<tr>
			<th>
				属 &nbsp;性</td>
			<th>
				描 &nbsp;述</td>
			<th>
				方 &nbsp;法</td>
			<th>
				描 &nbsp;述</td>
		</tr>
		<tr>
			<td>
				text</td>
			<td>
				字符串类型的响应内容</td>
			<td>
				json()</td>
			<td>
				将响应内容解析为 JSON 格式</td>
		</tr>
		<tr>
			<td>
				content</td>
			<td>
				字节类型的响应内容</td>
			<td>
				&nbsp;</td>
			<td>
				&nbsp;</td>
		</tr>
		<tr>
			<td>
				url</td>
			<td>
				响应的 URL</td>
			<td>
				&nbsp;</td>
			<td>
				&nbsp;</td>
		</tr>
		<tr>
			<td>
				status_code</td>
			<td>
				响应状态码</td>
			<td>
				&nbsp;</td>
			<td>
				&nbsp;</td>
		</tr>
		<tr>
			<td>
				headers</td>
			<td>
				响应头中的全部信息</td>
			<td>
				&nbsp;</td>
			<td>
				&nbsp;</td>
		</tr>
		<tr>
			<td>
				encoding</td>
			<td>
				设置编码格式</td>
			<td>
				&nbsp;</td>
			<td>
				&nbsp;</td>
		</tr>
	</tbody>
</table>
以下为 get() 函数的相关示例代码。<br />
<br />
爬取百度首页的源代码，示例代码如下：<br />
<pre class="python">
import requests
url=&quot;http://www.baidu.com&quot;
response=requests.get(url=url)
response.encoding=&quot;utf-8&quot;
print(response.url)
print(response.status_code)
print(response.headers)
res=response.text
with open(&quot;baidu.html&quot;,&quot;w&quot;,encoding=&quot;utf-8&quot;)as f:
    f.write(res)</pre>
<br />
爬取老夏学院的 Logo 图片，示例代码如下：
<pre class="python">
import requests
url=&quot;http://www.oldxia.com/xzd/upload/static/image/common/logo.png&quot;
response=requests.get(url=url)
#返回二进制的数据
res=response.content
with open(&quot;logo.png&quot;,&quot;wb&quot;)as f:
  f.write(res)</pre>
<br />
爬取 360 搜索首页的源代码，示例代码如下：
<pre class="python">
import requests
url=&quot;http://www.so.com&quot;
headers={
&quot;User-Agent&quot;:&quot;Mozilla/5.0(Windows NT 10.0;Win64;x64)AppleWebKit/537.36(KHTML, like Gecko)Chrome/74.0.3729.169 Safari/537.36&quot;,
}
response=requests.get(url=url,headers=headers)
response.encoding=&quot;utf-8&quot;
res=response.text
with open(&quot;360.html&quot;,&quot;w&quot;,encoding=&quot;utf-8&quot;)as f:
f.write(res)</pre>
<h4>
	2) post()函数</h4>
该函数表示使用 POST 方法发起 HTTP 请求，并返回 Response 对象，其语法格式如下：<br />
<pre class="info-box">
post(url,data,headers)</pre>
其中，参数 url 表示请求 URL；参数 data 表示 POST 方法的请求参数；参数 headers 表示请求头的信息。<br />
<br />
以下为 post() 函数的相关示例代码。<br />
<br />
访问老夏学院的 HTTP 请求测试页面，示例代码如下：
<pre class="python">
import requests
url=&quot;http://www.oldxia.com/http_test/post.php&quot;
data={&#39;name&#39;:&#39;夏正东&#39;,&#39;age&#39;:35}
response=requests.post(url=url,data=data)
res=response.text
print(res)</pre>
<br />
百度翻译 API，示例代码如下：<br />
<pre class="python">
import requests
url=&quot;https://fanyi.baidu.com/sug&quot;
name=input(&quot;请输入要查询的单词:&quot;)
headers={
&quot;User-Agent&quot;:&quot;Mozilla/5.0(Windows NT 10.0;Win64;x64)AppleWebKit/537.36(KHTML,like Gecko)Chrome/74.0.3729.169 Safari/537.36&quot;,
}
data={
&quot;kw&quot;:name
}
response=requests.post(url=url,headers=headers,data=data)
#响应头中的Content-Type为application/json
res=response.json()
print(res[&quot;data&quot;][0][&quot;v&quot;])</pre>
<h2>
	2、模拟登录</h2>
使用 requests 库进行模拟登录与 urllib 库一样，可以分为两种方式，即手动添加 Cookie 和自动保存 Cookie。<br />
<h4>
	1) 手动添加Cookie</h4>
该方式的应用过程与 urllib 库中手动添加 Cookie 的方式一致，示例代码如下
<pre class="python">
import requests
url=&quot;https://www.kuaidaili.com/usercenter/&quot;
headers={
    &quot;User-Agent&quot;:&quot;Mozilla/5.0(Windows NT 10.0;Win64;x64)AppleWebKit/537.36(KHTML, like Gecko)Chrome/74.0.3729.169 Safari/537.36&quot;,
    &quot;Cookie&quot;:&quot;channelid=0;sid=1629544743008400;_gcl_au=1.1.1908873876.1629544864;_ga=GA1.2.810344698.1629544865;_gid=GA1.2.2144128861.1629544865;Hm_lvt_7ed65b1cc4b810e9fd37959c9bb51b31=1629544865,1629599040; Hm_lpvt_7ed65b1cc4b810e9fd37959c9bb51b31=1629599043;sessionid=5465c0121d88e755b9ecad8b82109136&quot;
}
response=requests.get(url=url,headers=headers)
response.encoding=&quot;utf-8&quot;
res=response.text
with open(&quot;kuaidaili.html&quot;,&quot;w&quot;,encoding=&quot;utf-8&quot;)as f:
f.write(res)</pre>
<h4>
	2) 自动保存Cookie</h4>
该方式的应用过程与 urllib 库中自动保存 Cookie 的方式有所区别。<br />
<br />
在 requests 库中，首先，需要通过 Session 类创建 session 对象，该对象可以自动保存 Cookie，并且可以实现会话保持，然后，通过 session 对象的 get() 方法或 post() 方法发起 HTTP 请求即可，示例代码如下：<br />
<pre class="python">
import requests
#创建session对象,该对象会自动保存Cookie,并且可以实现会话保持
session=requests.Session()
url=&quot;https://www.kuaidaili.com/login/&quot;
#POST方法的请求参数
data={
    &quot;username&quot;:&quot;13309861086&quot;,
    &quot;passwd&quot;:&quot;www.oldxia.com&quot;
}
headers={
    &quot;User-Agent&quot;:&quot;Mozilla/5.0(Windows NT 10.0;Win64;x64)AppleWebKit/537.36(KHTML,
like Gecko)Chrome/74.0.3729.169 Safari/537.36&quot;,
}
#向登录页面发起HTTP请求,目的是获取成功登录后的Cookie,然后保存到session对象中
response=session.post(url=url,data=data,headers=headers)
new_url=&quot;https://www.kuaidaili.com/usercenter/&quot;
#使用已经自动保存Cookie的session对象向账户管理页面发起HTTP请求
new_response=session.get(url=new_url,headers=headers)
res=new_response.text
with open(&quot;kuaidaili.html&quot;,&quot;w&quot;,encoding=&quot;utf-8&quot;)as f:
    f.write(res)</pre>
<h2>
	3、使用代理IP</h2>
在 requests 库中，使用代理 IP 的应用过程较 urllib 库要简单许多，只需在 get() 函数或 post() 函数中添加参数 proxies，该参数表示代理 IP，并且同样可以分为两种，即免费代理 IP 和收费代理 IP，其格式与 urllib 库中所使用的格式一致，示例代码如下：
<pre class="python">
import requests
url=&#39;https://www.so.com/s?q=ip&#39;
#免费代理IP
#proxy={
#&quot;http&quot;:&quot;http://42.56.238.40:3000&quot;,
#&quot;https&quot;:&quot;http://42.56.238.40:3000&quot;
#}
#收费代理IP
proxy={
    &quot;http&quot;:&quot;http://xiazhengdong:3p0h090r@110.85.202.232:18937&quot;,
    &quot;https&quot;:&quot;http://xiazhengdong:3p0h090r@110.85.202.232:18937&quot;
}
headers={
    &quot;User-Agent&quot;:&quot;Mozilla/5.0(Windows NT 10.0;Win64;x64)AppleWebKit/537.36(KHTML,
like Gecko)Chrome/74.0.3729.169 Safari/537.36&quot;,
}
response=requests.get(url=url,headers=headers,proxies=proxy)
res=response.text
with open(&quot;so.html&quot;,&quot;w&quot;,encoding=&quot;utf-8&quot;)as f:
    f.write(res)</pre>
此时，运行 so.html 文件，其显示的 IP 为&ldquo;223.11.213.168中国山西省太原市中国电信&rdquo;，而笔者的真实 IP 为&ldquo;113.234.106.225中国辽宁省大连市中国联通&rdquo;。<br />
<h2>
	4、验证码登录</h2>
目前，互联网上绝大多数的网站采取了各式各样的措施来反网络爬虫技术，其中一个常用的措施便是要求输入验证码。<br />
<br />
早期的验证码是由纯数字随机组合而成的，后来加入了英文字母和混淆曲线等，并且随着技术的不断发展，验证码的种类也愈发繁多，包括有任意特殊字符的验证码、计算题类型的验证码、问答题类型的验证码和坐标类型的验证码等。<br />
<br />
Python 网络爬虫实现验证码登录的基本原理很简单。首先，需要将网站登录页面中的验证码图片保存下来，然后获取该图片中验证码的信息，并统一封装，最后使用 POST 方法发送给服务器，进而实现验证码登录。<br />
<br />
虽然基本原理非常简单，但是需要注意的是，在获取验证码和登录时，必须使用 session 对象来保持同一个会话，以保证获取验证码和登录时的 Cookie 一致，否则无法成功登录。<br />
<br />
而关于获取验证码中信息的方法，推荐读者使用第三方识别平台，如超级鹰等，因为个人开发的验证码识别 API，其所能识别的验证码种类较少，并且识别率不高，相比来讲，虽然第三方平台需要付费使用，但是费用相对较低，并且识别验证码的种类非常全面，识别成功率也极高，可以帮助读者极大地节省开发时间。</div>
	<div id="ggxc-weixin-arcbottom">
	<p>关注公众号「<span class="col-green">站长严长生</span>」，在手机上阅读所有教程，随时随地都能学习。内含一款搜索神器，免费下载全网书籍和视频。</p>
	<p style="margin-top:12px; text-align:center;">
		<img src="../templets/new/images/material/qrcode_mp_4.png" alt="公众号二维码" width="160" /><br />
		<span class="col-green">微信扫码关注公众号</span>
	</p>
</div>
	<div id="nice-arcs" class="box-bottom">
    <h4>推荐阅读</h4>
    <ul class="clearfix">
<li><a href="niz69i_8.html" title="一套完整的嵌入式开发学习路线（高薪就业版）" target="_blank">一套完整的嵌入式开发学习路线（高薪就业版）</a></li>
<li><a href="tnnfqo_4.html" title="一套课程卖1万，TMD太贵了！" target="_blank">一套课程卖1万，TMD太贵了！</a></li>
<li><a href="unnurw_4.html" title="跑了3000公里，见了一位大佬" target="_blank">跑了3000公里，见了一位大佬</a></li>
<li><a href="778_2.html" title="Java关系运算符" target="_blank">Java关系运算符</a></li>
<li><a href="6227_2.html" title="PHP array_keys()：获得数组中的键名" target="_blank">PHP array_keys()：获得数组中的键名</a></li>
<li><a href="7809_2.html" title="C++11 long long超长整形详解" target="_blank">C++11 long long超长整形详解</a></li>
<li><a href="../jstl/fmt-parsedate_2.html" title="&lt;fmt:parseDate&gt;标签" target="_blank">&lt;fmt:parseDate&gt;标签</a></li>
<li><a href="../spring/annotation-aspectj_2.html" title="Spring使用AspectJ进行AOP开发（基于注解）" target="_blank">Spring使用AspectJ进行AOP开发（基于注解）</a></li>
<li><a href="wbwadz7_2.html" title="C++打开文件的两种方式（文件流类和open函数）" target="_blank">C++打开文件的两种方式（文件流类和open函数）</a></li>
<li><a href="2l377uh_2.html" title="大数据凉了，不建议学了" target="_blank">大数据凉了，不建议学了</a></li>
</ul>
</div>
	
</div>
<script type="text/javascript">
// 当前文章ID
window.arcIdRaw = 'a_' + 10406;
window.arcId = "5390vPUUvUWKlYpmE2WlZUeWKhRu5iTpxtWBlp4bcPSEZdAuUO39xRpsXuj3";
window.typeidChain = "145|119";
</script>
<div id="footer" class="clearfix">
	<div class="info left">
	<p>精美而实用的网站，分享优质编程教程，帮助有志青年。千锤百炼，只为大作；精益求精，处处斟酌；这种教程，看一眼就倾心。</p>
	<p>
		<a href="8066_2.html" target="_blank" rel="nofollow">关于网站</a> <span>|</span>
		<a href="8092_3.html" target="_blank" rel="nofollow">关于站长</a> <span>|</span>
		<a href="8097_2.html" target="_blank" rel="nofollow">如何完成一部教程</a> <span>|</span>
		<a href="9648_2.html" target="_blank" rel="nofollow">公众号</a> <span>|</span>
		<a href="8093_2.html" target="_blank" rel="nofollow">联系我们</a> <span>|</span>
		<a href="../sitemap/sitemap_2.html" target="_blank" rel="nofollow">网站地图</a>
	</p>
	<p>Copyright ©2012-2022 biancheng.net, <a href="https://beian.miit.gov.cn" target="_blank" rel="nofollow" style="color:#666;">冀ICP备2022013920号</a>, <img height="13" src="../templets/new/images/gongan_2.png" alt="公安备案图标" /><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=13110202001352" target="_blank" rel="nofollow" style="color:#666;">冀公网安备13110202001352号</a>
	</p>
	</div>
	<img id="logo_bottom" class="right" src="https://m.biancheng.net/templets/new/images/logo_bottom_2.gif" alt="底部Logo" />
	<span id="return-top"><b>↑</b></span>
</div>

<div id="addweixin-widget">
	<p>
		<script type="text/javascript">
			/*var suffix = 'c';
			var thisMin = (new Date()).getMinutes();
			if(thisMin>=40){
				suffix = 'd';
			}else if(thisMin>=20){
				suffix = 'e';
			}else{
				suffix = 'c';
			}
			document.write('<img src="https://m.biancheng.net/templets/new/images/material/qrcode_wx_'%20+%20suffix%20+'.png?v=1.7.07" alt="微信交流群" width="120" /><br />');*/
		</script>
		<img src="https://m.biancheng.net/templets/new/images/material/qrcode_mp_4.png" alt="微信交流群" width="120" />
		<span>关注微信公众号，加入官方交流群。内含一款搜索神器，免费下载全网书籍和视频。</span>
	</p>
	<span id="close-addweixin-widget" class="iconfont iconfont-close"></span>
</div>

<script type="text/javascript">
window.siteId = 4;
window.cmsTemplets = "/templets/new";
window.cmsTempletsVer = "1.7.07";

</script>

<script src="https://m.biancheng.net/templets/new/script/jquery1.12.4.min_2.js"></script>
<script src="https://m.biancheng.net/templets/new/script/common_2.js"></script>
<!-- 51la V6 -->
<span style="display: none;">
<script charset="UTF-8" id="LA_COLLECT" src="https://sdk.51.la/js-sdk-pro.min.js"></script>
<script>LA.init({id:"KDf6QzBhogyQjall",ck:"KDf6QzBhogyQjall",autoTrack:true})</script>
</span>
<!-- 51la V5 -->
<!-- <span style="display: none;"><script type="text/javascript" src="https://js.users.51.la/21368967.js"></script></span> -->
</body>
</html>